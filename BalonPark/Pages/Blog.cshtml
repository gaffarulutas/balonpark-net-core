@page
@model BalonPark.Pages.BlogModel
@{
    Layout = "_Layout";
    var settings = ViewData["SiteSettings"] as BalonPark.Models.Settings;
    var companyName = settings?.CompanyName ?? "Balon Park Şişme Oyun Grupları";
    ViewData["Title"] = $"Blog - {settings?.MetaTitle ?? companyName}";
    ViewData["Description"] = $"{companyName} blog sayfasında şişme oyun parkları, çocuk eğlence alanları ve bakım ipuçları hakkında güncel yazıları keşfedin.";
    ViewData["Keywords"] = "blog, şişme oyun parkı, çocuk oyun alanı, şişme kaydırak, şişme havuz, balon park";
}

<!-- Blog Collection Structured Data -->
<script type="application/ld+json">
    {
        "@@context": "https://schema.org",
        "@@type": "CollectionPage",
        "name": "Blog - @Html.Raw(companyName)",
    "description": "@Html.Raw(companyName) blog sayfasında şişme oyun parkları, çocuk eğlence alanları ve bakım ipuçları hakkında güncel yazıları keşfedin.",
    "url": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl("/blog") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/blog")",
    "mainEntity": {
        "@@type": "ItemList",
        "name": "Blog Yazıları",
        "description": "Şişme oyun parkları ve çocuk eğlence alanları hakkında blog yazıları",
        "numberOfItems": "@Model.Blogs.Count",
        "itemListElement": [
    @for (var i = 0; i < Model.Blogs.Count && i < 10; i++)
    {
        var blog = Model.Blogs[i];
        @: {
        @:     "@@type": "ListItem",
        @:     "position": @(i + 1),
        @:     "item": {
        @:         "@@type": "BlogPosting",
        @:         "headline": "@System.Net.WebUtility.HtmlEncode(blog.Title)",
        @:         "description": "@System.Net.WebUtility.HtmlEncode(blog.Excerpt ?? blog.Title)",
        @:         "url": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl($"/blog/{blog.Slug}") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/blog/{blog.Slug}")",
        @:         "image": "@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl(blog.FeaturedImage ?? "/assets/images/logo/logo.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/{(blog.FeaturedImage ?? "/assets/images/logo/logo.png")}")",
        @:         "datePublished": "@blog.CreatedAt.ToString("yyyy-MM-dd")",
        @:         "dateModified": "@(blog.UpdatedAt?.ToString("yyyy-MM-dd") ?? blog.CreatedAt.ToString("yyyy-MM-dd"))",
        @:         "author": {
        @:             "@@type": "Organization",
        @:             "name": "Balon Park Şişme Oyun Grupları"
        @:         },
        @:         "publisher": {
        @:             "@@type": "Organization",
        @:             "name": "Balon Park Şişme Oyun Grupları",
        @:             "logo": {
        @:                 "@@type": "ImageObject",
        @:                 "url": "@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/logo/logo.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/logo/logo.png")"
        @:             }
        @:         }
        @:     }
        @: }@(i < Math.Min(Model.Blogs.Count, 10) - 1 ? "," : "")
    }
    ]
},
"breadcrumb": {
    "@@type": "BreadcrumbList",
    "itemListElement": [
        {
            "@@type": "ListItem",
            "position": 1,
            "name": "Ana Sayfa",
            "item": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl("/") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/")"
            },
            {
                "@@type": "ListItem",
                "position": 2,
                "name": "Blog",
                "item": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl("/blog") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/blog")"
            }
        ]
    }
}
</script>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 space-y-4 sm:space-y-6">
        @await Html.PartialAsync("Shared/_Breadcrumb", new List<BreadcrumbItem>
        {
            BreadcrumbItem.Link("Ana Sayfa", "/"),
            BreadcrumbItem.Current("Blog")
        })

        <div class="pt-1 pb-2.5 border-b border-gray-100">
            <h2 class="text-ink text-base font-medium">Blog</h2>
            <p class="text-gray-400 text-xs mt-0.5">Şişme oyun parkları ve çocuk eğlence alanları hakkında yazılar</p>
        </div>

        <form method="get" asp-page="/Blog" role="search" class="flex flex-col sm:flex-row gap-2 sm:gap-3 p-4 rounded-xl border border-gray-100 bg-white blog-search-form">
            <input type="text" name="q" value="@Model.SearchQuery" placeholder="Blog yazılarında ara..." aria-label="Blog yazılarında ara" class="flex-1 rounded border border-gray-200 pl-3.5 pr-3 py-2.5 text-sm text-ink placeholder-gray-400 focus:border-primary focus:ring-1 focus:ring-primary">
            <button type="submit" class="inline-flex items-center justify-center gap-2 px-5 py-2.5 rounded bg-primary text-white font-medium text-sm hover:bg-primary-dark transition">
                <i data-lucide="search" class="w-4 h-4"></i> Ara
            </button>
        </form>

        @if (Model.BlogCategories?.Any() == true)
        {
            <div class="flex flex-wrap gap-2 p-4 rounded-xl border border-gray-100 bg-white blog-categories">
                <a href="/blog" class="inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium transition @(string.IsNullOrEmpty(Model.SelectedCategory) && string.IsNullOrEmpty(Model.SelectedTag) ? "bg-primary text-white" : "bg-gray-100 text-gray-600 hover:bg-gray-200")">
                    Tümü
                </a>
                @foreach (var category in Model.BlogCategories)
                {
                    <a href="/blog?category=@Uri.EscapeDataString(category)" class="inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium transition @(Model.SelectedCategory == category ? "bg-primary text-white" : "bg-gray-100 text-gray-600 hover:bg-gray-200 hover:text-ink")">
                        @category
                    </a>
                }
            </div>
        }

        @if (Model.Blogs?.Any() == true)
        {
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                @foreach (var blog in Model.Blogs)
                {
                    <article class="group bg-white rounded-xl border border-gray-100 overflow-hidden hover:border-gray-200 hover:shadow-md transition-all duration-200 flex flex-col">
                        <a href="/blog/@blog.Slug" class="block aspect-[16/10] bg-gray-100 overflow-hidden">
                            @if (!string.IsNullOrEmpty(blog.FeaturedImage))
                            {
                                <img src="@Model.UrlService?.GetImageUrl(blog.FeaturedImage)" alt="@blog.Title" class="lazy-image w-full h-full object-cover group-hover:opacity-95 transition-opacity duration-200" loading="lazy">
                            }
                            else
                            {
                                <div class="w-full h-full flex items-center justify-center bg-gray-100">
                                    <i data-lucide="image" class="w-10 h-10 text-gray-300"></i>
                                </div>
                            }
                        </a>
                        <div class="p-4 flex flex-col flex-1">
                            @if (!string.IsNullOrEmpty(blog.Category))
                            {
                                <a href="/blog?category=@Uri.EscapeDataString(blog.Category)" class="inline-flex w-fit mb-2 px-2.5 py-1 rounded-full bg-primary text-white text-xs font-medium hover:bg-primary-dark transition">
                                    @blog.Category
                                </a>
                            }
                            <h2 class="text-ink text-base font-semibold leading-snug mb-1.5">
                                <a href="/blog/@blog.Slug" class="hover:text-primary transition">@blog.Title</a>
                            </h2>
                            @if (!string.IsNullOrEmpty(blog.Excerpt))
                            {
                                <p class="text-gray-500 text-sm line-clamp-2 mb-3">@blog.Excerpt</p>
                            }
                            <div class="flex flex-wrap items-center gap-3 text-xs text-gray-400 mt-auto">
                                <span class="flex items-center gap-1"><i data-lucide="user" class="w-3.5 h-3.5 flex-shrink-0"></i> @(blog.AuthorName ?? companyName)</span>
                                <span class="flex items-center gap-1"><i data-lucide="calendar" class="w-3.5 h-3.5 flex-shrink-0"></i> @(blog.PublishedAt?.ToString("dd.MM.yyyy") ?? blog.CreatedAt.ToString("dd.MM.yyyy"))</span>
                                @if (blog.ViewCount > 0)
                                {
                                    <span class="flex items-center gap-1"><i data-lucide="eye" class="w-3.5 h-3.5 flex-shrink-0"></i> @blog.ViewCount görüntüleme</span>
                                }
                            </div>
                        </div>
                    </article>
                }
            </div>

            @if (Model.TotalPages > 1)
            {
                <nav class="flex justify-center items-center gap-1.5 flex-wrap mt-6" aria-label="Sayfa navigasyonu">
                    @{
                        var qs = Model.GetQueryStringFragment();
                    }
                    @if (Model.CurrentPage > 1)
                    {
                        <a href="/blog?page=@(Model.CurrentPage - 1)@qs" class="inline-flex items-center justify-center w-9 h-9 rounded border border-gray-200 text-ink text-sm hover:bg-gray-50 transition" aria-label="Önceki">&laquo;</a>
                    }
                    @for (int i = Math.Max(1, Model.CurrentPage - 2); i <= Math.Min(Model.TotalPages, Model.CurrentPage + 2); i++)
                    {
                        @if (i == Model.CurrentPage)
                        {
                            <span class="inline-flex items-center justify-center w-9 h-9 rounded bg-primary text-white text-sm font-medium">@i</span>
                        }
                        else
                        {
                            <a href="/blog?page=@i@qs" class="inline-flex items-center justify-center w-9 h-9 rounded border border-gray-200 text-ink text-sm hover:bg-gray-50 transition">@i</a>
                        }
                    }
                    @if (Model.CurrentPage < Model.TotalPages)
                    {
                        <a href="/blog?page=@(Model.CurrentPage + 1)@qs" class="inline-flex items-center justify-center w-9 h-9 rounded border border-gray-200 text-ink text-sm hover:bg-gray-50 transition" aria-label="Sonraki">&raquo;</a>
                    }
                </nav>
            }
        }
        else
        {
            @await Html.PartialAsync("Shared/_ResultNotFound", new ResultNotFoundViewModel
            {
                Icon = "newspaper",
                Title = "Henüz blog yazısı bulunmuyor",
                Description = "Yakında güncel blog yazılarımızı paylaşacağız."
            })
        }
    </div>

    <aside class="space-y-6 lg:col-span-1">
            @if (Model.FeaturedBlogs?.Any() == true)
            {
                <div class="rounded-xl border border-gray-100 bg-white p-4">
                    <h3 class="text-ink text-sm font-semibold mb-3 pb-2 border-b border-gray-100">Öne Çıkan Yazılar</h3>
                    <ul class="space-y-3">
                        @foreach (var featuredBlog in Model.FeaturedBlogs)
                        {
                            <li class="flex gap-3 pb-3 border-b border-gray-50 last:border-0 last:pb-0">
                                @if (!string.IsNullOrEmpty(featuredBlog.FeaturedImage))
                                {
                                    <a href="/blog/@featuredBlog.Slug" class="flex-shrink-0 w-20 h-14 rounded overflow-hidden bg-gray-100">
                                        <img src="@Model.UrlService?.GetImageUrl(featuredBlog.FeaturedImage)" alt="@featuredBlog.Title" class="lazy-image w-full h-full object-cover" loading="lazy">
                                    </a>
                                }
                                else
                                {
                                    <a href="/blog/@featuredBlog.Slug" class="flex-shrink-0 w-20 h-14 rounded bg-gray-100 flex items-center justify-center">
                                        <i data-lucide="image" class="w-5 h-5 text-gray-300"></i>
                                    </a>
                                }
                                <div class="min-w-0 flex-1">
                                    <a href="/blog/@featuredBlog.Slug" class="text-sm font-medium text-ink hover:text-primary line-clamp-2 transition">@featuredBlog.Title</a>
                                    <p class="text-xs text-gray-400 mt-0.5">@(featuredBlog.PublishedAt?.ToString("dd.MM.yyyy") ?? featuredBlog.CreatedAt.ToString("dd.MM.yyyy"))</p>
                                </div>
                            </li>
                        }
                    </ul>
                </div>
            }
            @if (Model.LatestBlogs?.Any() == true)
            {
                <div class="rounded-xl border border-gray-100 bg-white p-4">
                    <h3 class="text-ink text-sm font-semibold mb-3 pb-2 border-b border-gray-100">Son Yazılar</h3>
                    <ul class="space-y-3">
                        @foreach (var latestBlog in Model.LatestBlogs)
                        {
                            <li class="flex gap-3 pb-3 border-b border-gray-50 last:border-0 last:pb-0">
                                @if (!string.IsNullOrEmpty(latestBlog.FeaturedImage))
                                {
                                    <a href="/blog/@latestBlog.Slug" class="flex-shrink-0 w-20 h-14 rounded overflow-hidden bg-gray-100">
                                        <img src="@Model.UrlService?.GetImageUrl(latestBlog.FeaturedImage)" alt="@latestBlog.Title" class="lazy-image w-full h-full object-cover" loading="lazy">
                                    </a>
                                }
                                else
                                {
                                    <a href="/blog/@latestBlog.Slug" class="flex-shrink-0 w-20 h-14 rounded bg-gray-100 flex items-center justify-center">
                                        <i data-lucide="image" class="w-5 h-5 text-gray-300"></i>
                                    </a>
                                }
                                <div class="min-w-0 flex-1">
                                    <a href="/blog/@latestBlog.Slug" class="text-sm font-medium text-ink hover:text-primary line-clamp-2 transition">@latestBlog.Title</a>
                                    <p class="text-xs text-gray-400 mt-0.5">@(latestBlog.PublishedAt?.ToString("dd.MM.yyyy") ?? latestBlog.CreatedAt.ToString("dd.MM.yyyy"))</p>
                                </div>
                            </li>
                        }
                    </ul>
                </div>
            }
            <div class="rounded-xl border border-gray-100 bg-white p-4">
                <h3 class="text-ink text-sm font-semibold mb-2 pb-2 border-b border-gray-100">Blog Aboneliği</h3>
                <p class="text-sm text-gray-500 mb-3">Blog yazılarımızı kaçırmamak için RSS aboneliği yapabilirsiniz.</p>
                <a href="/blog/feed" class="inline-flex items-center gap-2 w-full justify-center py-2.5 px-4 rounded border border-primary text-primary font-medium text-sm hover:bg-primary hover:text-white transition">
                    <i data-lucide="rss" class="w-4 h-4"></i> RSS Aboneliği
                </a>
            </div>
        </aside>
</div>
