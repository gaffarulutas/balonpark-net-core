@page
@model BalonPark.Pages.Admin.GoogleShopping.IndexModel
@{
    Layout = "_AdminLayout";
    ViewData["Title"] = "Google Shopping Yönetimi";
}

<!-- Header -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-800 flex items-center gap-3">
                <svg class="w-8 h-8 text-gray-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
                Google Shopping Yönetimi
            </h1>
            <p class="text-gray-600 mt-2">@Model.TotalProducts aktif ürün</p>
        </div>
        <div class="flex items-center gap-3 mt-4 md:mt-0">
            <div class="w-12 h-12 bg-gray-900 text-white rounded-full flex items-center justify-center text-xl font-bold">
                @Model.AdminUserName.Substring(0, 1).ToUpper()
            </div>
            <div>
                <p class="font-semibold text-gray-800">@Model.AdminUserName</p>
                <p class="text-sm text-gray-500">@Model.AdminEmail</p>
            </div>
        </div>
    </div>
</div>

<!-- Messages -->
@if (!string.IsNullOrEmpty(Model.StatusMessage))
{
    @if (Model.IsSuccess)
    {
        <div class="bg-green-50 border-l-4 border-green-400 p-4 mb-6 rounded-r-lg">
            <div class="flex items-center">
                <svg class="w-6 h-6 text-green-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                    <p class="font-semibold text-green-800">Başarılı!</p>
                    <p class="text-green-700">@Model.StatusMessage</p>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="bg-red-50 border-l-4 border-red-400 p-4 mb-6 rounded-r-lg">
            <div class="flex items-center">
                <svg class="w-6 h-6 text-red-400 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <div>
                    <p class="font-semibold text-red-800">Hata!</p>
                    <p class="text-red-700">@Model.StatusMessage</p>
                </div>
            </div>
        </div>
    }
}

<!-- Status Cards -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="text-center">
            @if (Model.IsAuthenticated)
            {
                <svg class="mx-auto w-20 h-20 text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <p class="text-3xl font-bold text-green-600 mb-2">Bağlı</p>
            }
            else
            {
                <svg class="mx-auto w-20 h-20 text-red-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <p class="text-3xl font-bold text-red-600 mb-2">Bağlantı Yok</p>
            }
            <p class="text-gray-600 font-medium">API Durumu</p>
            
            @if (!Model.IsAuthenticated)
            {
                <div class="mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                    <p class="text-sm text-yellow-800">
                        <svg class="w-4 h-4 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                        </svg>
                        Google Shopping API bağlantısı kurulamadı.
                    </p>
                </div>
            }
        </div>
    </div>
    
    <div class="bg-gradient-to-br from-gray-800 to-gray-900 rounded-xl shadow-lg p-6 text-white">
        <div class="flex items-center justify-between">
            <div>
                <p class="text-blue-100 text-sm font-medium">Aktif Ürün</p>
                <p class="text-5xl font-bold mt-2">@Model.TotalProducts</p>
            </div>
            <svg class="w-16 h-16 text-blue-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
            </svg>
        </div>
    </div>
</div>

<!-- Action Buttons -->
<div class="bg-white rounded-lg shadow-md p-6 mb-6">
    <h3 class="text-xl font-semibold text-gray-800 mb-4">Hızlı İşlemler</h3>
    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
        <button type="button" onclick="testConnection()" class="inline-flex flex-col items-center justify-center px-4 py-3 bg-gray-900 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
            </svg>
            <span class="text-xs">Bağlantı Test</span>
        </button>
        
        <button type="button" onclick="submitForApproval()" class="inline-flex flex-col items-center justify-center px-4 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors duration-200">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
            </svg>
            <span class="text-xs">Onaya Gönder</span>
        </button>
        
        <button type="button" onclick="refreshProducts()" class="inline-flex flex-col items-center justify-center px-4 py-3 bg-gray-900 hover:bg-gray-900 text-white font-medium rounded-lg transition-colors duration-200">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            <span class="text-xs">Yenile</span>
        </button>
        
        <button type="button" onclick="checkStatus()" class="inline-flex flex-col items-center justify-center px-4 py-3 bg-teal-600 hover:bg-teal-700 text-white font-medium rounded-lg transition-colors duration-200">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
            </svg>
            <span class="text-xs">Durum Kontrol</span>
        </button>
        
        <button type="button" onclick="exportProducts()" class="inline-flex flex-col items-center justify-center px-4 py-3 bg-orange-600 hover:bg-orange-700 text-white font-medium rounded-lg transition-colors duration-200">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
            </svg>
            <span class="text-xs">Dışa Aktar</span>
        </button>
        
        <button type="button" onclick="syncAllProducts()" class="inline-flex flex-col items-center justify-center px-4 py-3 bg-gray-800 hover:bg-purple-700 text-white font-medium rounded-lg transition-colors duration-200">
            <svg class="w-6 h-6 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
            <span class="text-xs">Tümünü Güncelle</span>
        </button>
    </div>
</div>

<!-- Approval Status -->
@if (Model.ApprovalStatus.Any())
{
    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
        <h3 class="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            Onay Durumu
        </h3>
        
        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
            <div>
                <p class="font-semibold text-blue-800">@Model.ApprovalStatus.GetValueOrDefault("status", "Durum bilinmiyor")</p>
                <p class="text-blue-700 mt-1">@Model.ApprovalStatus.GetValueOrDefault("message", "")</p>
                @if (Model.ApprovalStatus.ContainsKey("recommendation"))
                {
                    <div class="mt-3 inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                        @Model.ApprovalStatus["recommendation"]
                    </div>
                }
            </div>
        </div>
    </div>
}

<!-- Pending Products -->
@if (Model.PendingProducts.Any())
{
    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
        <div class="p-6 border-b border-gray-200">
            <h3 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                Onaya Gönderilecek Ürünler
            </h3>
            <p class="text-gray-600 mt-1">@Model.PendingProducts.Count ürün hazır</p>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Başlık</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fiyat</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">GTIN</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Durum</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    @foreach (var product in Model.PendingProducts.Take(10))
                    {
                        <tr class="hover:bg-gray-50 transition-colors duration-150">
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">@product.Id</td>
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">@Html.Raw(product.Title)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">@product.Price.ToString("N2", System.Globalization.CultureInfo.InvariantCulture) @product.Currency</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <code class="px-2 py-1 bg-gray-100 rounded text-sm text-gray-800">@product.Gtin</code>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">@product.CustomLabel0</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    Hazır
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
        
        @if (Model.PendingProducts.Count > 10)
        {
            <div class="p-4 bg-blue-50 border-t border-blue-100">
                <p class="text-sm text-blue-700 flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Ve @(Model.PendingProducts.Count - 10) ürün daha...
                </p>
            </div>
        }
    </div>
}

@if (Model.GoogleProducts != null && Model.GoogleProducts.Any())
{
    <div class="bg-white rounded-lg shadow-md overflow-hidden mb-6">
        <div class="p-6 border-b border-gray-200 flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
                <h3 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                    <svg class="w-6 h-6 text-gray-900" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                    </svg>
                    Google Shopping Ürünleri
                </h3>
                <p class="text-gray-600 mt-1">@Model.GoogleProducts.Count ürün bulundu</p>
            </div>
            <div class="flex gap-2 mt-4 md:mt-0">
                <button type="button" onclick="selectAllProducts()" class="inline-flex items-center px-4 py-2 bg-gray-900 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Tümünü Seç
                </button>
                <button type="button" onclick="bulkDeleteProducts()" id="bulkDeleteBtn" disabled class="inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white font-medium rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                    Seçilenleri Sil (<span id="selectedCount">0</span>)
                </button>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200" id="productsTable">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left">
                            <input type="checkbox" id="selectAllCheckbox" onchange="toggleSelectAll()" class="w-4 h-4 text-gray-900 border-gray-300 rounded focus:ring-gray-800">
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Başlık</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fiyat</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Durum</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kategori</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">İşlemler</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    @foreach (var product in Model.GoogleProducts)
                    {
                        <tr class="hover:bg-gray-50 transition-colors duration-150">
                            <td class="px-6 py-4 whitespace-nowrap">
                                <input type="checkbox" class="product-checkbox w-4 h-4 text-gray-900 border-gray-300 rounded focus:ring-gray-800" value="@product.Id" onchange="updateSelectedCount()">
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">@product.Id</td>
                            <td class="px-6 py-4 text-sm font-medium text-gray-900">@Html.Raw(product.Title)</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">@product.Price.ToString("N2", System.Globalization.CultureInfo.InvariantCulture) @product.Currency</td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                @if (product.Availability == "in stock")
                                {
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                                        </svg>
                                        Stokta
                                    </span>
                                }
                                else
                                {
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800">
                                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
                                        </svg>
                                        Stok Yok
                                    </span>
                                }
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">@product.CustomLabel0</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <div class="flex items-center gap-1">
                                    <button type="button" onclick="viewProduct('@product.Id')" class="inline-flex items-center p-1.5 bg-gray-900 hover:bg-blue-700 text-white rounded transition-colors duration-200" title="Görüntüle">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                        </svg>
                                    </button>
                                    <button type="button" onclick="updateProduct('@product.Id')" class="inline-flex items-center p-1.5 bg-green-600 hover:bg-green-700 text-white rounded transition-colors duration-200" title="Güncelle">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                        </svg>
                                    </button>
                                    <button type="button" onclick="deleteProduct('@product.Id')" class="inline-flex items-center p-1.5 bg-red-600 hover:bg-red-700 text-white rounded transition-colors duration-200" title="Sil">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
else
{
    <div class="bg-white rounded-lg shadow-md p-12 text-center">
        <svg class="mx-auto w-16 h-16 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
        </svg>
        <p class="text-gray-600">Google Shopping'da henüz ürün bulunmuyor.</p>
    </div>
}

<!-- Anti-forgery Token -->
@Html.AntiForgeryToken()

@section Scripts {
    <script>

        async function testConnection() {
            showLoading();
            try {
                const response = await fetch('/admin/googleshopping?handler=TestConnection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    Swal.fire({
                        title: 'Başarılı!',
                        text: 'Google Shopping API bağlantısı başarılı!',
                        icon: 'success',
                        confirmButtonColor: '#1f2937',
                        confirmButtonText: 'Tamam'
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire({
                        title: 'Hata!',
                        text: 'Bağlantı başarısız: ' + result.message,
                        icon: 'error',
                        confirmButtonColor: '#1f2937',
                        confirmButtonText: 'Tamam'
                    });
                }
            } catch (error) {
                Swal.fire({
                    title: 'Hata!',
                    text: 'Bir hata oluştu: ' + error.message,
                    icon: 'error',
                    confirmButtonColor: '#1f2937',
                    confirmButtonText: 'Tamam'
                });
            } finally {
                hideLoading();
            }
        }

        async function syncAllProducts() {
            const result = await Swal.fire({
                title: 'Onay Gerekli',
                text: 'Tüm ürünleri Google Shopping\'a senkronize etmek istediğinizden emin misiniz?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#1f2937',
                cancelButtonColor: '#9ca3af',
                confirmButtonText: 'Evet, Senkronize Et',
                cancelButtonText: 'İptal',
                reverseButtons: true
            });
            
            if (result.isConfirmed) {
                await performSync();
            }
        }

        async function performSync() {

            showLoading();
            try {
                const response = await fetch('/admin/googleshopping?handler=SyncAllProducts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    Swal.fire({
                        title: 'Başarılı!',
                        text: 'Senkronizasyon başarılı! ' + result.message,
                        icon: 'success',
                        confirmButtonColor: '#1f2937',
                        confirmButtonText: 'Tamam'
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire({
                        title: 'Hata!',
                        text: 'Senkronizasyon başarısız: ' + result.message,
                        icon: 'error',
                        confirmButtonColor: '#1f2937',
                        confirmButtonText: 'Tamam'
                    });
                }
            } catch (error) {
                Swal.fire({
                    title: 'Hata!',
                    text: 'Bir hata oluştu: ' + error.message,
                    icon: 'error',
                    confirmButtonColor: '#1f2937',
                    confirmButtonText: 'Tamam'
                });
            } finally {
                hideLoading();
            }
        }

        async function viewGoogleProducts() {
            showLoading();
            try {
                const response = await fetch('/admin/googleshopping?handler=ViewGoogleProducts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    Swal.fire({
                        title: 'Başarılı!',
                        text: 'Google ürünleri başarıyla yüklendi!',
                        icon: 'success',
                        confirmButtonColor: '#1f2937'
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire({
                        title: 'Hata!',
                        text: 'Google ürünleri yüklenemedi: ' + result.message,
                        icon: 'error',
                        confirmButtonColor: '#1f2937'
                    });
                }
            } catch (error) {
                Swal.fire({
                    title: 'Hata!',
                    text: 'Bir hata oluştu: ' + error.message,
                    icon: 'error',
                    confirmButtonColor: '#1f2937'
                });
            } finally {
                hideLoading();
            }
        }

        async function syncAllProducts() {
            const result = await Swal.fire({
                title: 'Onay Gerekli',
                html: 'Tüm ürünleri Google Shopping ile senkronize etmek istediğinizden emin misiniz?<br><br>Bu işlem tüm ürünleri güncelleyecek ve biraz zaman alabilir.',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#1f2937',
                cancelButtonColor: '#9ca3af',
                confirmButtonText: 'Evet, Senkronize Et',
                cancelButtonText: 'İptal',
                reverseButtons: true
            });
            
            if (result.isConfirmed) {
                showLoading();
                try {
                    const response = await fetch('/admin/googleshopping?handler=SyncAllProducts', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                        }
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            Swal.fire({
                                title: 'Başarılı!',
                                text: result.message,
                                icon: 'success',
                                confirmButtonColor: '#1f2937'
                            }).then(() => {
                                location.reload();
                            });
                        } else {
                            Swal.fire({
                                title: 'Hata',
                                text: result.message,
                                icon: 'error',
                                confirmButtonColor: '#1f2937'
                            });
                        }
                    } else {
                        Swal.fire({
                            title: 'Hata',
                            text: 'Sunucu hatası oluştu!',
                            icon: 'error',
                            confirmButtonColor: '#1f2937'
                        });
                    }
                } catch (error) {
                    Swal.fire({
                        title: 'Hata',
                        text: error.message,
                        icon: 'error',
                        confirmButtonColor: '#1f2937'
                    });
                } finally {
                    hideLoading();
                }
            }
        }

        // Checkbox ile toplu silme fonksiyonları
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            const productCheckboxes = document.querySelectorAll('.product-checkbox');
            
            productCheckboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            updateSelectedCount();
        }

        function selectAllProducts() {
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            selectAllCheckbox.checked = true;
            toggleSelectAll();
        }

        function updateSelectedCount() {
            const selectedCheckboxes = document.querySelectorAll('.product-checkbox:checked');
            const selectedCount = selectedCheckboxes.length;
            const bulkDeleteBtn = document.getElementById('bulkDeleteBtn');
            const selectedCountSpan = document.getElementById('selectedCount');
            
            selectedCountSpan.textContent = selectedCount;
            
            if (selectedCount > 0) {
                bulkDeleteBtn.disabled = false;
            } else {
                bulkDeleteBtn.disabled = true;
            }
            
            // Tümünü seç checkbox'ını güncelle
            const totalCheckboxes = document.querySelectorAll('.product-checkbox').length;
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            
            if (selectedCount === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (selectedCount === totalCheckboxes) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }

        async function bulkDeleteProducts() {
            const selectedCheckboxes = document.querySelectorAll('.product-checkbox:checked');
            const selectedIds = Array.from(selectedCheckboxes).map(cb => cb.value);
            
            if (selectedIds.length === 0) {
                Swal.fire({
                    title: 'Uyarı',
                    text: 'Lütfen silinecek ürünleri seçin!',
                    icon: 'warning',
                    confirmButtonColor: '#1f2937'
                });
                return;
            }
            
            const result = await Swal.fire({
                title: 'Onay Gerekli',
                html: `Seçilen ${selectedIds.length} ürünü Google Shopping'dan silmek istediğinizden emin misiniz?<br><br><strong>Bu işlem geri alınamaz!</strong>`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc2626',
                cancelButtonColor: '#9ca3af',
                confirmButtonText: 'Evet, Sil',
                cancelButtonText: 'İptal',
                reverseButtons: true
            });
            
            if (result.isConfirmed) {
                showLoading();
                try {
                    const response = await fetch('/admin/googleshopping?handler=BulkDeleteProducts', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                        },
                        body: JSON.stringify(selectedIds)
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            Swal.fire({
                                title: 'Başarılı!',
                                text: result.message,
                                icon: 'success',
                                confirmButtonColor: '#1f2937'
                            }).then(() => {
                                location.reload();
                            });
                        } else {
                            Swal.fire({
                                title: 'Hata',
                                text: result.message,
                                icon: 'error',
                                confirmButtonColor: '#1f2937'
                            });
                        }
                    } else {
                        Swal.fire({
                            title: 'Hata',
                            text: 'Sunucu hatası oluştu!',
                            icon: 'error',
                            confirmButtonColor: '#1f2937'
                        });
                    }
                } catch (error) {
                    Swal.fire({
                        title: 'Hata',
                        text: error.message,
                        icon: 'error',
                        confirmButtonColor: '#1f2937'
                    });
                } finally {
                    hideLoading();
                }
            }
        }

        async function exportProducts() {
            showLoading();
            try {
                const response = await fetch('/admin/googleshopping?handler=ExportProducts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'google-shopping-products.json';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    Swal.fire({
                        title: 'Başarılı!',
                        text: 'Ürünler başarıyla dışa aktarıldı!',
                        icon: 'success',
                        confirmButtonColor: '#1f2937'
                    });
                } else {
                    const result = await response.json();
                    Swal.fire({
                        title: 'Hata!',
                        text: 'Dışa aktarma başarısız: ' + result.message,
                        icon: 'error',
                        confirmButtonColor: '#1f2937'
                    });
                }
            } catch (error) {
                Swal.fire({
                    title: 'Hata!',
                    text: 'Bir hata oluştu: ' + error.message,
                    icon: 'error',
                    confirmButtonColor: '#1f2937'
                });
            } finally {
                hideLoading();
            }
        }

        function viewProduct(productId) {
            window.open('/admin/googleshopping/product-detail/' + productId, '_blank');
        }

        function updateProduct(productId) {
            window.open('/admin/googleshopping/update-product/' + productId, '_blank');
        }

        async function submitForApproval() {
            const result = await Swal.fire({
                title: 'Onaya Gönder',
                html: 'Tüm ürünleri Google Shopping onayına göndermek istediğinizden emin misiniz?<br><br><strong>Google 24-48 saat içinde işleyecek.</strong>',
                icon: 'info',
                showCancelButton: true,
                confirmButtonColor: '#16a34a',
                cancelButtonColor: '#9ca3af',
                confirmButtonText: 'Evet, Onaya Gönder',
                cancelButtonText: 'İptal',
                reverseButtons: true
            });
            
            if (result.isConfirmed) {
                await performSubmitForApproval();
            }
        }

        async function performSubmitForApproval() {
            showLoading();
            try {
                const response = await fetch('/admin/googleshopping?handler=SubmitForApproval', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    Swal.fire({
                        title: 'Başarılı!',
                        html: result.message + '<br><br><strong>Sonraki Adımlar:</strong><br>• Google Merchant Center\'ı kontrol edin<br>• 24-48 saat içinde onay durumunu kontrol edin<br>• Ürünler Google Shopping\'da görünmeye başlayacak',
                        icon: 'success',
                        confirmButtonColor: '#1f2937'
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire({
                        title: 'Hata!',
                        text: 'Onaya gönderme başarısız: ' + result.message,
                        icon: 'error',
                        confirmButtonColor: '#1f2937'
                    });
                }
            } catch (error) {
                Swal.fire({
                    title: 'Hata!',
                    text: 'Bir hata oluştu: ' + error.message,
                    icon: 'error',
                    confirmButtonColor: '#1f2937'
                });
            } finally {
                hideLoading();
            }
        }

        async function refreshProducts() {
            showLoading();
            try {
                const response = await fetch('/admin/googleshopping?handler=RefreshProducts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    Swal.fire({
                        title: 'Başarılı!',
                        text: result.message,
                        icon: 'success',
                        confirmButtonColor: '#1f2937'
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire({
                        title: 'Hata!',
                        text: 'Ürün listesi yenilenemedi: ' + result.message,
                        icon: 'error',
                        confirmButtonColor: '#1f2937'
                    });
                }
            } catch (error) {
                Swal.fire({
                    title: 'Hata!',
                    text: 'Bir hata oluştu: ' + error.message,
                    icon: 'error',
                    confirmButtonColor: '#1f2937'
                });
            } finally {
                hideLoading();
            }
        }

        async function checkStatus() {
            showLoading();
            try {
                const response = await fetch('/admin/googleshopping?handler=CheckStatus', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    let statusHtml = '<strong>Durum Raporu:</strong><br><br>';
                    if (result.status) {
                        for (const [key, value] of Object.entries(result.status)) {
                            statusHtml += `<strong>${key}:</strong> ${value}<br>`;
                        }
                    }
                    
                    Swal.fire({
                        title: 'Durum Raporu',
                        html: statusHtml,
                        icon: 'info',
                        confirmButtonColor: '#1f2937'
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire({
                        title: 'Hata!',
                        text: 'Durum kontrolü başarısız: ' + result.message,
                        icon: 'error',
                        confirmButtonColor: '#1f2937'
                    });
                }
            } catch (error) {
                Swal.fire({
                    title: 'Hata!',
                    text: 'Bir hata oluştu: ' + error.message,
                    icon: 'error',
                    confirmButtonColor: '#1f2937'
                });
            } finally {
                hideLoading();
            }
        }

        async function deleteProduct(productId) {
            const result = await Swal.fire({
                title: 'Ürün Silme Onayı',
                html: 'Bu ürünü Google Shopping\'dan silmek istediğinizden emin misiniz?<br><br><strong>Bu işlem geri alınamaz!</strong>',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc2626',
                cancelButtonColor: '#9ca3af',
                confirmButtonText: 'Evet, Sil',
                cancelButtonText: 'İptal',
                reverseButtons: true
            });
            
            if (result.isConfirmed) {
                await performDelete(productId);
            }
        }

        async function performDelete(productId) {

            showLoading();
            try {
                const response = await fetch('/admin/googleshopping?handler=DeleteProduct&productId=' + productId, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'RequestVerificationToken': document.querySelector('input[name="__RequestVerificationToken"]').value
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    Swal.fire({
                        title: 'Başarılı!',
                        text: 'Ürün başarıyla silindi!',
                        icon: 'success',
                        confirmButtonColor: '#1f2937'
                    }).then(() => {
                        location.reload();
                    });
                } else {
                    Swal.fire({
                        title: 'Hata!',
                        text: 'Ürün silinemedi: ' + result.message,
                        icon: 'error',
                        confirmButtonColor: '#1f2937'
                    });
                }
            } catch (error) {
                Swal.fire({
                    title: 'Hata!',
                    text: 'Bir hata oluştu: ' + error.message,
                    icon: 'error',
                    confirmButtonColor: '#1f2937'
                });
            } finally {
                hideLoading();
            }
        }
    </script>
}