@page
@model IndexModel
@{
    var settings = ViewData["SiteSettings"] as BalonPark.Models.Settings;
    var companyName = settings?.CompanyName ?? "Balon Park Şişme Oyun Grupları";
    
    ViewData["Title"] = $"Şişme Oyun Parkları ve Çocuk Oyun Grupları | {settings?.MetaTitle ?? companyName}";
    ViewData["Description"] = "Türkiye'nin en kaliteli şişme oyun parkları, kaydıraklar, havuzlar ve çocuk oyun grupları. Güvenli, dayanıklı ve eğlenceli ürünler. Hızlı teslimat ve uygun fiyatlar. Çocuklarınız için en iyi oyun deneyimi!";
    ViewData["Keywords"] = "şişme oyun parkı, şişme kaydırak, şişme havuz, şişme rodeo, top havuzu, iç mekan oyun parkları, trambolin, softplay oyuncaklar, yer balonları, balon tak, fly tüp, şişme kostüm, reklam balonları, balon park, çocuk oyun grupları, şişme oyuncaklar, çocuk parkı, oyun alanı, eğlence parkı, çocuk eğlence merkezi";
    ViewData["Image"] = settings?.Logo != null ? (((IUrlService?)ViewData["UrlService"])?.GetImageUrl(settings.Logo) ?? settings.Logo) : (((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/logo/logo.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/logo/logo.png");
}

<!-- Additional SEO Structured Data for Homepage -->
<script type="application/ld+json">
{
    "@@context": "https://schema.org",
    "@@type": "WebSite",
    "name": "@Html.Raw(companyName)",
    "alternateName": "@Html.Raw(companyName.Replace(" ", ""))",
    "url": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl("/") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/")",
    "description": "@Html.Raw(settings?.About ?? "Türkiye'nin en kaliteli şişme oyun parkları, kaydıraklar, havuzlar ve çocuk oyun grupları üreticisi")",
    "potentialAction": {
        "@@type": "SearchAction",
        "target": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl("/Search") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/Search")?q={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    "publisher": {
        "@@type": "Organization",
        "name": "@Html.Raw(companyName)",
        "logo": {
            "@@type": "ImageObject",
            "url": "@(settings?.Logo != null ? (((IUrlService?)ViewData["UrlService"])?.GetImageUrl(settings.Logo) ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}{settings.Logo}") : (((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/logo/logo.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/logo/logo.png"))"
        }
    }
}
</script>

<!-- Hero + Product Section -->

<div class="space-y-4 sm:space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="md:col-span-2 relative rounded-xl overflow-hidden bg-gray-100 aspect-[2/1] min-h-[200px]">
            <img src="~/assets/images/1.png" class="absolute inset-0 w-full h-full object-cover" alt="Şişme Oyun Parkları ve Çocuk Oyun Grupları - Balon Park Eğlence Merkezi" loading="lazy" width="800" height="400">
            <div class="absolute inset-0 bg-gradient-to-r from-black/50 to-transparent flex flex-col justify-center p-6 sm:p-8">
                <span class="text-primary font-medium text-sm sm:text-base">Hazır Olun</span>
                <h2 class="text-white text-2xl sm:text-3xl font-bold mt-1">EĞLENCEYE!</h2>
                <p class="text-white/90 text-sm mt-2 max-w-md hidden sm:block">Çocuklarınız için güvenli ve eğlenceli şişme oyun grupları ile unutulmaz anlar yaşayın.</p>
                <a href="/category/siseme-parklar/sisme-kaydirak" class="inline-flex items-center gap-2 mt-4 px-5 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg font-medium text-sm transition w-fit">
                    Ürünleri Gör <i class="fa-solid fa-arrow-right"></i>
                </a>
            </div>
        </div>
        <div class="relative rounded-xl overflow-hidden bg-gray-100 aspect-[2/1] md:aspect-auto min-h-[200px]">
            <img src="~/assets/images/2.png" class="absolute inset-0 w-full h-full object-cover" alt="" loading="lazy">
            <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent flex flex-col justify-end p-6">
                <span class="text-primary font-medium text-sm">Kaliteli</span>
                <h2 class="text-white text-xl font-bold mt-1">Güvenli</h2>
                <p class="text-white/90 text-sm mt-1">En İyi Fiyatlarla Sizlerle</p>
                <a href="/category/siseme-parklar/sisme-oyun-parki" class="inline-flex items-center gap-2 mt-3 px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg font-medium text-sm transition w-fit">
                    Ürünleri Gör <i class="fa-solid fa-arrow-right"></i>
                </a>
            </div>
        </div>
    </div>

    <div class="pt-2">
        <h2 class="text-primary text-lg font-semibold">Öne Çıkan Ürünler</h2>
        <p class="text-gray-500 text-sm mt-0.5">Tüm kategorilerden seçilmiş harika ürünlerimizi keşfedin</p>
    </div>

    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 sm:gap-6">
    @if (Model.Products.Any())
    {
        @foreach (var item in Model.Products)
        {
            <article class="group bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-md hover:border-primary/30 transition-all duration-300 flex flex-col">
                <div class="relative flex items-center justify-end gap-2 p-2 opacity-0 group-hover:opacity-100 transition-opacity bg-white/90">
                    <button type="button" class="favorite-btn p-2 rounded-lg text-gray-500 hover:text-red-500 hover:bg-red-50" data-product-id="@item.Product.Id" title="Favori"><i class="fa-regular fa-heart"></i></button>
                    <button type="button" class="compare-btn p-2 rounded-lg text-gray-500 hover:text-primary hover:bg-primary/10" data-product-id="@item.Product.Id" title="Karşılaştır"><i class="fa-solid fa-shuffle"></i></button>
                </div>
                <a href="/category/@item.Product.CategorySlug/@item.Product.SubCategorySlug/@item.Product.Slug" class="block aspect-square bg-gray-100 overflow-hidden">
                    @if (item.MainImage != null)
                    {
                        <img src="@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl(item.MainImage.ThumbnailPath) ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/{item.MainImage.ThumbnailPath}")" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" alt="@Html.Raw(item.Product.Name)" loading="lazy">
                    }
                    else
                    {
                        <img src="@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/no-image.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/no-image.png")" class="w-full h-full object-cover" alt="@Html.Raw(item.Product.Name)">
                    }
                </a>
                <div class="p-4 flex flex-col flex-1">
                    <a href="/category/@item.Product.CategorySlug/@item.Product.SubCategorySlug/@item.Product.Slug" class="font-semibold text-gray-800 hover:text-primary line-clamp-2 transition">@Html.Raw(item.Product.Name)</a>
                    <p class="text-xs text-gray-500 mt-0.5">@Html.Raw(item.Product.CategoryName)</p>
                    @if (!string.IsNullOrEmpty(item.Product.Description))
                    {
                        <p class="text-sm text-gray-600 mt-1 line-clamp-2">@Html.Raw(item.Product.Description.Length > 60 ? item.Product.Description.Substring(0, 60) + "..." : item.Product.Description)</p>
                    }
                    @if (!string.IsNullOrEmpty(item.Product.Dimensions))
                    {
                        <p class="text-xs text-gray-500 mt-1 flex items-center gap-1"><i class="fa-solid fa-ruler-combined"></i> @Html.Raw(item.Product.Dimensions)</p>
                    }
                    <div class="mt-auto pt-3">
                        @if (item.Product.Price <= 0)
                        {
                            <p class="text-sm text-gray-500">Fiyat için iletişime geçin</p>
                        }
                        else
                        {
                            <p class="price-tl text-primary font-semibold @(Model.SelectedCurrency == "TL" ? "block" : "hidden")">₺@item.Product.Price.ToString("N2")</p>
                            <p class="price-usd text-primary font-semibold @(Model.SelectedCurrency == "USD" ? "block" : "hidden")">$@item.Product.UsdPrice.ToString("N2")</p>
                            <p class="price-eur text-primary font-semibold @(Model.SelectedCurrency == "EUR" ? "block" : "hidden")">€@item.Product.EuroPrice.ToString("N2")</p>
                        }
                    </div>
                </div>
            </article>
        }
    }
    else
    {
        <div class="col-span-full text-center py-12 px-4 bg-gray-50 rounded-xl border border-gray-200">
            <h3 class="text-lg font-semibold text-gray-700">Şu anda ürün bulunmamaktadır</h3>
            <p class="text-gray-500 mt-2">Lütfen daha sonra tekrar kontrol edin veya bizimle iletişime geçin.</p>
        </div>
    }
    </div>
</div>

@if (Model.TotalPages > 1)
{
    <nav class="flex justify-center items-center gap-2 flex-wrap mt-8" aria-label="Sayfa navigasyonu">
        @if (Model.CurrentPage > 1)
        {
            <a href="?PageNumber=@(Model.CurrentPage - 1)" class="inline-flex items-center justify-center w-10 h-10 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-100" aria-label="Önceki">&laquo;</a>
        }
        @{
            int startPage = Math.Max(1, Model.CurrentPage - 2);
            int endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
        }
        @if (startPage > 1)
        {
            <a href="?PageNumber=1" class="inline-flex items-center justify-center w-10 h-10 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-100">1</a>
            @if (startPage > 2) { <span class="px-2 text-gray-400">...</span> }
        }
        @for (int i = startPage; i <= endPage; i++)
        {
            @if (i == Model.CurrentPage)
            {
                <span class="inline-flex items-center justify-center w-10 h-10 rounded-lg bg-primary text-white font-medium">@i</span>
            }
            else
            {
                <a href="?PageNumber=@i" class="inline-flex items-center justify-center w-10 h-10 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-100">@i</a>
            }
        }
        @if (endPage < Model.TotalPages)
        {
            @if (endPage < Model.TotalPages - 1) { <span class="px-2 text-gray-400">...</span> }
            <a href="?PageNumber=@Model.TotalPages" class="inline-flex items-center justify-center w-10 h-10 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-100">@Model.TotalPages</a>
        }
        @if (Model.CurrentPage < Model.TotalPages)
        {
            <a href="?PageNumber=@(Model.CurrentPage + 1)" class="inline-flex items-center justify-center w-10 h-10 rounded-lg border border-gray-300 text-gray-600 hover:bg-gray-100" aria-label="Sonraki">&raquo;</a>
        }
        <span class="text-sm text-gray-500 ml-4">Sayfa @Model.CurrentPage / @Model.TotalPages (@Model.TotalProducts ürün)</span>
    </nav>
}
<!-- Product Section End -->

@section Scripts {
<script>
    // Pagination Debug
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
    });
</script>
}
