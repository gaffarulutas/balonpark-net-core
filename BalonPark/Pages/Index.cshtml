@page
@model IndexModel
@{
    var settings = ViewData["SiteSettings"] as BalonPark.Models.Settings;
    var companyName = settings?.CompanyName ?? "Balon Park Şişme Oyun Grupları";
    
    ViewData["Title"] = $"Şişme Oyun Parkları ve Çocuk Oyun Grupları | {settings?.MetaTitle ?? companyName}";
    ViewData["Description"] = "Türkiye'nin en kaliteli şişme oyun parkları, kaydıraklar, havuzlar ve çocuk oyun grupları. Güvenli, dayanıklı ve eğlenceli ürünler. Hızlı teslimat ve uygun fiyatlar. Çocuklarınız için en iyi oyun deneyimi!";
    ViewData["Keywords"] = "şişme oyun parkı, şişme kaydırak, şişme havuz, şişme rodeo, top havuzu, iç mekan oyun parkları, trambolin, softplay oyuncaklar, yer balonları, balon tak, fly tüp, şişme kostüm, reklam balonları, balon park, çocuk oyun grupları, şişme oyuncaklar, çocuk parkı, oyun alanı, eğlence parkı, çocuk eğlence merkezi";
    ViewData["Image"] = settings?.Logo != null ? (((IUrlService?)ViewData["UrlService"])?.GetImageUrl(settings.Logo) ?? settings.Logo) : (((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/logo/logo.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/logo/logo.png");
}

<!-- Additional SEO Structured Data for Homepage -->
<script type="application/ld+json">
{
    "@@context": "https://schema.org",
    "@@type": "WebSite",
    "name": "@Html.Raw(companyName)",
    "alternateName": "@Html.Raw(companyName.Replace(" ", ""))",
    "url": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl("/") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/")",
    "description": "@Html.Raw(settings?.About ?? "Türkiye'nin en kaliteli şişme oyun parkları, kaydıraklar, havuzlar ve çocuk oyun grupları fabrikası")",
    "potentialAction": {
        "@@type": "SearchAction",
        "target": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl("/Search") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/Search")?q={search_term_string}",
        "query-input": "required name=search_term_string"
    },
    "publisher": {
        "@@type": "Organization",
        "name": "@Html.Raw(companyName)",
        "logo": {
            "@@type": "ImageObject",
            "url": "@(settings?.Logo != null ? (((IUrlService?)ViewData["UrlService"])?.GetImageUrl(settings.Logo) ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}{settings.Logo}") : (((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/logo/logo.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/logo/logo.png"))"
        }
    }
}
</script>

<!-- Hero + Kategoriler (solda) + Product Section -->

<div class="space-y-4 sm:space-y-6">
    <div class="grid grid-cols-1 md:grid-cols-[280px_1fr] gap-4 overflow-visible md:items-stretch">
        <!-- Sol panel: left_image.jpg + overlay (sağdaki swiper ile aynı overlay yapısı) -->
        <div class="hero-left-panel order-2 md:order-1 rounded-xl overflow-hidden bg-gray-100 border border-gray-200 shadow-sm flex flex-col md:h-full min-h-[200px] md:min-h-0">
            <div class="relative flex-1 min-h-[180px] md:min-h-0 md:h-full">
                <img src="~/assets/images/left_image.jpg" alt="Balon Park - İç Mekan Şişme Oyun Parkı" class="absolute inset-0 w-full h-full object-cover" loading="eager" width="280" height="400">
                <div class="hero-left-overlay">
                    <span class="text-primary font-medium text-sm sm:text-base">İç Mekan Oyun Parkı</span>
                    <h2 class="text-white text-xl sm:text-2xl font-bold mt-1 leading-tight">Hareket, Oyun, Güven</h2>
                    <p class="text-white/90 text-sm mt-2 line-clamp-2 hidden sm:block">İç mekan şişme parklarımızla çocuklarınız güvenle oynasın; doğum günü ve etkinlikler için ideal.</p>
                    <a href="/category/siseme-parklar/sisme-oyun-parki" class="inline-flex items-center gap-2 mt-4 px-5 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg font-medium text-sm transition w-fit">
                        Keşfet <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    </a>
                </div>
            </div>
        </div>

        <!-- Hero: Swiper slider (assets/images/slider) -->
        <div class="hero-row order-1 md:order-2 min-w-0 w-full md:h-full">
            <div class="hero-panel relative rounded-xl overflow-hidden bg-gray-100 min-w-0 w-full h-full">
                <div class="hero-aspect w-full h-full relative hero-swiper-wrap">
                    <div class="swiper heroSwiper" aria-label="Ana sayfa banner slider">
                        <div class="swiper-wrapper">
                            <div class="swiper-slide">
                                <div class="hero-slide-inner">
                                    <img src="~/assets/images/slider/1.jpeg" class="hero-slide-img" alt="Şişme Oyun Parkları - Balon Park" loading="eager" width="800" height="400">
                                    <div class="hero-slide-overlay">
                                        <span class="text-primary font-medium text-sm sm:text-base">Şişme Oyun Parkları</span>
                                        <h2 class="text-white text-2xl sm:text-3xl font-bold mt-1">Eğlence ve Güven Bir Arada</h2>
                                        <p class="text-white/90 text-sm mt-2 max-w-md hidden sm:block">Çocuklarınız için özenle üretilmiş şişme kaydıraklar, havuzlar ve oyun grupları. Evinize veya işletmenize renk katın.</p>
                                        <a href="/category/siseme-parklar/sisme-kaydirak" class="inline-flex items-center gap-2 mt-4 px-5 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg font-medium text-sm transition w-fit">
                                            Ürünleri Keşfet <i data-lucide="arrow-right" class="w-4 h-4"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="swiper-slide">
                                <div class="hero-slide-inner">
                                    <img src="~/assets/images/slider/2.jpeg" class="hero-slide-img" alt="Kaliteli Güvenli - Balon Park" loading="lazy" width="800" height="400">
                                    <div class="hero-slide-overlay">
                                        <span class="text-primary font-medium text-sm sm:text-base">Kaliteli Üretim</span>
                                        <h2 class="text-white text-2xl sm:text-3xl font-bold mt-1">Dayanıklı, Güvenli, Eğlenceli</h2>
                                        <p class="text-white/90 text-sm mt-2 max-w-md hidden sm:block">CE belgeli malzemeler ve canlı renklerle uzun ömürlü ürünler. Doğru şişme parkı için kategorilerimize göz atın.</p>
                                        <a href="/category/siseme-parklar/sisme-oyun-parki" class="inline-flex items-center gap-2 mt-4 px-5 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg font-medium text-sm transition w-fit">
                                            Kategorilere Göz At <i data-lucide="arrow-right" class="w-4 h-4"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="hero-swiper-nav-group">
                            <button type="button" class="swiper-button-prev hero-swiper-prev" aria-label="Önceki slide"></button>
                            <button type="button" class="swiper-button-next hero-swiper-next" aria-label="Sonraki slide"></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- En Çok Bakılan Ürünler (Swiper) - üstte -->
    @if (Model.MostViewedProducts.Any())
    {
        <section class="home-section" aria-labelledby="most-viewed-heading">
            <div class="section-header">
                <div>
                    <h2 id="most-viewed-heading" class="section-title">En Çok Bakılan Ürünler</h2>
                    <p class="section-subtitle">Müşterilerimizin en çok incelediği ürünler</p>
                </div>
                <div class="most-viewed-swiper-nav">
                    <button type="button" class="swiper-button-prev most-viewed-prev" aria-label="Önceki ürünler"></button>
                    <button type="button" class="swiper-button-next most-viewed-next" aria-label="Sonraki ürünler"></button>
                </div>
            </div>
            <div class="swiper mostViewedSwiper">
                <div class="swiper-wrapper">
                    @foreach (var item in Model.MostViewedProducts)
                    {
                        <div class="swiper-slide">
                            @await Html.PartialAsync("Shared/_ProductCard", new ProductCardViewModel { Item = item, SelectedCurrency = Model.SelectedCurrency })
                        </div>
                    }
                </div>
            </div>
        </section>
    }

    <!-- Öne Çıkan Ürünler -->
    <section class="home-section" aria-labelledby="featured-heading">
        <div class="section-header">
            <div>
                <h2 id="featured-heading" class="section-title">Öne Çıkan Ürünler</h2>
                <p class="section-subtitle">Tüm kategorilerden seçilmiş ürünler</p>
            </div>
            <a href="/Products" class="section-link">Tümünü Gör</a>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 items-stretch">
            @if (Model.Products.Any())
            {
                @foreach (var item in Model.Products)
                {
                    @await Html.PartialAsync("Shared/_ProductCard", new ProductCardViewModel { Item = item, SelectedCurrency = Model.SelectedCurrency })
                }
            }
            else
            {
                <div class="col-span-full text-center py-12 px-4 bg-gray-50 rounded-xl border border-gray-100">
                    <h3 class="text-base font-medium text-ink">Şu anda ürün bulunmamaktadır</h3>
                    <p class="text-sm text-gray-500 mt-1">Lütfen daha sonra tekrar kontrol edin veya bizimle iletişime geçin.</p>
                </div>
            }
        </div>
    </section>
</div>

@if (Model.TotalPages > 1)
{
    <nav class="flex justify-center items-center gap-1.5 flex-wrap mt-6" aria-label="Sayfa navigasyonu">
        @if (Model.CurrentPage > 1)
        {
            <a href="?PageNumber=@(Model.CurrentPage - 1)" class="inline-flex items-center justify-center w-9 h-9 rounded border border-gray-200 text-ink text-sm hover:bg-gray-50 transition" aria-label="Önceki">&laquo;</a>
        }
        @{
            int startPage = Math.Max(1, Model.CurrentPage - 2);
            int endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
        }
        @if (startPage > 1)
        {
            <a href="?PageNumber=1" class="inline-flex items-center justify-center w-9 h-9 rounded border border-gray-200 text-ink text-sm hover:bg-gray-50 transition">1</a>
            @if (startPage > 2) { <span class="px-1.5 text-gray-400 text-sm">...</span> }
        }
        @for (int i = startPage; i <= endPage; i++)
        {
            @if (i == Model.CurrentPage)
            {
                <span class="inline-flex items-center justify-center w-9 h-9 rounded bg-primary text-white text-sm font-medium">@i</span>
            }
            else
            {
                <a href="?PageNumber=@i" class="inline-flex items-center justify-center w-9 h-9 rounded border border-gray-200 text-ink text-sm hover:bg-gray-50 transition">@i</a>
            }
        }
        @if (endPage < Model.TotalPages)
        {
            @if (endPage < Model.TotalPages - 1) { <span class="px-1.5 text-gray-400 text-sm">...</span> }
            <a href="?PageNumber=@Model.TotalPages" class="inline-flex items-center justify-center w-9 h-9 rounded border border-gray-200 text-ink text-sm hover:bg-gray-50 transition">@Model.TotalPages</a>
        }
        @if (Model.CurrentPage < Model.TotalPages)
        {
            <a href="?PageNumber=@(Model.CurrentPage + 1)" class="inline-flex items-center justify-center w-9 h-9 rounded border border-gray-200 text-ink text-sm hover:bg-gray-50 transition" aria-label="Sonraki">&raquo;</a>
        }
        <span class="text-xs text-gray-500 ml-3">Sayfa @Model.CurrentPage / @Model.TotalPages (@Model.TotalProducts ürün)</span>
    </nav>
}
<!-- Product Section End -->

@section Styles {
<style>
    /* Hero: kategori ile aynı yükseklik (md’de), mobilde sabit oran */
    .hero-row { width: 100%; }
    .hero-panel { isolation: isolate; width: 100%; }
    .hero-aspect {
        display: block;
        width: 100%;
        min-height: 220px;
        position: relative;
    }
    /* Mobil: daha yüksek hero (2:1 oran, max 420px) */
    .hero-aspect {
        aspect-ratio: 2 / 1;
        max-height: 420px;
    }
    @@supports not (aspect-ratio: 2/1) {
        .hero-aspect { height: 0; padding-bottom: 50%; }
        .hero-aspect > * { position: absolute; inset: 0; }
    }
    @@media (min-width: 768px) {
        .hero-aspect {
            aspect-ratio: auto;
            max-height: none;
            height: 100%;
            min-height: 420px;
        }
    }
    @@media (max-width: 767px) {
        .hero-aspect { max-height: 420px; }
    }
    /* Sol panel: resim üzerinde koyu overlay (metin okunaklılığı) */
    .hero-left-overlay {
        background: rgba(0, 0, 0, 0.35);
        pointer-events: none;
    }
    /* Hero Swiper: container tam doldurur, slide içerik absolute */
    .hero-swiper-wrap { overflow: hidden; }
    .heroSwiper { width: 100%; height: 100%; }
    .heroSwiper .swiper-wrapper { align-items: stretch; }
    .heroSwiper .swiper-slide { height: 100%; }
    .hero-slide-inner {
        position: relative;
        width: 100%;
        height: 100%;
        min-height: 220px;
    }
    .hero-slide-img {
        position: absolute;
        inset: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    .hero-slide-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(to right, rgba(0,0,0,0.5) 0%, transparent 60%);
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-end;
        padding: 1.5rem 1.75rem 1.5rem 1.5rem;
        text-align: left;
    }
    .hero-slide-overlay > * {
        margin-bottom: 0.5rem;
    }
    .hero-slide-overlay > *:last-child {
        margin-bottom: 0;
    }
    @@media (min-width: 640px) {
        .hero-slide-overlay { padding: 2rem 2.25rem 2rem 2rem; }
        .hero-slide-overlay > * { margin-bottom: 0.5em; }
    }
    /* Sol panel overlay: sağdaki swiper ile aynı yapı (padding, hiyerarşi), alttan üste gradient */
    .hero-left-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(to top, rgba(0,0,0,0.75) 0%, rgba(0,0,0,0.35) 45%, transparent 100%);
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: flex-end;
        padding: 1.5rem 1.75rem 1.5rem 1.5rem;
        text-align: left;
    }
    .hero-left-overlay > * { margin-bottom: 0.5rem; }
    .hero-left-overlay > *:last-child { margin-bottom: 0; }
    @@media (min-width: 640px) {
        .hero-left-overlay { padding: 2rem 2.25rem 2rem 2rem; }
        .hero-left-overlay > * { margin-bottom: 0.5em; }
    }
    /* Hero nav: Swiper CDN .swiper-button-prev/next (position:absolute; left/right:10px) ile çakışmasın */
    .hero-swiper-nav-group {
        position: absolute;
        top: 1rem;
        right: 1rem;
        z-index: 12;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    .hero-swiper-nav-group .swiper-button-prev,
    .hero-swiper-nav-group .swiper-button-next {
        position: relative !important;
        left: auto !important;
        right: auto !important;
        top: auto !important;
        bottom: auto !important;
        margin: 0 !important;
        margin-top: 0 !important;
        transform: none !important;
        width: 40px;
        height: 40px;
        min-width: 40px;
        min-height: 40px;
        border-radius: 50%;
        flex-shrink: 0;
        color: #fff;
        background: rgba(0,0,0,0.3);
        border: none;
    }
    .hero-swiper-nav-group .swiper-button-prev:hover,
    .hero-swiper-nav-group .swiper-button-next:hover { background: rgba(0,0,0,0.5); color: #fff; }
    .hero-swiper-nav-group .swiper-button-prev::after,
    .hero-swiper-nav-group .swiper-button-next::after { font-size: 1.125rem !important; }
    .hero-swiper-nav-group .swiper-button-disabled { opacity: 0.4; }
    /* Ana sayfa bölümleri (e-commerce) */
    .home-section { margin-top: 2rem; }
    @@media (min-width: 768px) {
        .home-section { margin-top: 2.5rem; }
    }
    .section-header {
        display: flex;
        flex-wrap: wrap;
        align-items: flex-end;
        justify-content: space-between;
        gap: 1rem;
        margin-bottom: 1.25rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid #f3f4f6;
    }
    .section-title {
        margin: 0;
        font-size: 1.25rem;
        font-weight: 600;
        color: #111827;
    }
    .section-subtitle {
        margin: 0.25rem 0 0 0;
        font-size: 0.8125rem;
        color: #9ca3af;
    }
    .section-link {
        font-size: 0.875rem;
        font-weight: 500;
        color: #00a8e8;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
    }
    .section-link:hover { color: #0090c9; text-decoration: underline; }
    /* En Çok Bakılan Swiper nav: CDN .swiper-button-prev/next (absolute, left/right) ile çakışmasın */
    .most-viewed-swiper-nav {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-shrink: 0;
    }
    .most-viewed-swiper-nav .swiper-button-prev,
    .most-viewed-swiper-nav .swiper-button-next {
        position: relative !important;
        left: auto !important;
        right: auto !important;
        top: auto !important;
        bottom: auto !important;
        margin: 0 !important;
        margin-top: 0 !important;
        transform: none !important;
        width: 40px;
        height: 40px;
        min-width: 40px;
        min-height: 40px;
        border-radius: 50%;
        border: 1px solid #e5e7eb;
        background: #fff;
        color: #374151;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.2s, color 0.2s;
    }
    .most-viewed-swiper-nav .swiper-button-prev:hover,
    .most-viewed-swiper-nav .swiper-button-next:hover { background: #f3f4f6; color: #00a8e8; }
    .most-viewed-swiper-nav .swiper-button-prev::after,
    .most-viewed-swiper-nav .swiper-button-next::after { font-size: 1.125rem !important; }
    .most-viewed-swiper-nav .swiper-button-disabled { opacity: 0.4; cursor: not-allowed; }
    .mostViewedSwiper {
        overflow: hidden;
    }
    .mostViewedSwiper .swiper-wrapper { align-items: stretch; }
    .mostViewedSwiper .swiper-slide {
        height: auto;
        box-sizing: border-box;
    }
    .mostViewedSwiper .swiper-slide .product-card { height: 100%; }
    /* Sol panel: slider ile aynı yükseklik (md) */
    @@media (min-width: 768px) {
        .hero-left-panel .relative { min-height: 100%; }
    }
</style>
}

@section Scripts {
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var urlParams = new URLSearchParams(window.location.search);
        // Hero Swiper
        function runHeroSwiper() {
            if (typeof window.Swiper === 'undefined') return;
            var heroEl = document.querySelector('.heroSwiper');
            if (!heroEl || heroEl.swiper) return;
            var nextEl = heroEl.querySelector('.hero-swiper-next');
            var prevEl = heroEl.querySelector('.hero-swiper-prev');
            var opts = {
                loop: true,
                speed: 500,
                autoplay: { delay: 5000, disableOnInteraction: false },
                grabCursor: true,
                keyboard: { enabled: true },
                observer: true,
                observeParents: true,
                a11y: { prevSlideMessage: 'Önceki', nextSlideMessage: 'Sonraki' }
            };
            if (nextEl && prevEl) opts.navigation = { nextEl: nextEl, prevEl: prevEl };
            new window.Swiper(heroEl, opts);
        }
        setTimeout(runHeroSwiper, 100);
        window.addEventListener('load', function() { runHeroSwiper(); });

        // En Çok Bakılan Ürünler Swiper (nav butonları aynı section içinde)
        function runMostViewedSwiper() {
            if (typeof window.Swiper === 'undefined') return;
            var el = document.querySelector('.mostViewedSwiper');
            if (!el || el.swiper) return;
            var section = el.closest('section');
            var nextEl = section ? section.querySelector('.most-viewed-next') : document.querySelector('.most-viewed-next');
            var prevEl = section ? section.querySelector('.most-viewed-prev') : document.querySelector('.most-viewed-prev');
            var slideCount = el.querySelectorAll('.swiper-slide').length;
            var opts = {
                slidesPerView: 2,
                spaceBetween: 16,
                speed: 400,
                grabCursor: true,
                watchSlidesProgress: true,
                autoplay: slideCount > 1 ? { delay: 4500, disableOnInteraction: false } : false,
                navigation: (nextEl && prevEl) ? { nextEl: nextEl, prevEl: prevEl } : false,
                observer: true,
                observeParents: true,
                breakpoints: {
                    480: { slidesPerView: 2, spaceBetween: 16 },
                    640: { slidesPerView: 2, spaceBetween: 18 },
                    768: { slidesPerView: 3, spaceBetween: 20 },
                    1024: { slidesPerView: 4, spaceBetween: 20 },
                    1280: { slidesPerView: 5, spaceBetween: 24 }
                }
            };
            if (slideCount >= 2) opts.loop = true;
            new window.Swiper(el, opts);
        }
        setTimeout(runMostViewedSwiper, 150);
    });
</script>
}
