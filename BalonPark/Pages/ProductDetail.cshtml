@page "/category/{categorySlug}/{subCategorySlug}/{productSlug}"
@model ProductDetailModel
@{
    var settings = ViewData["SiteSettings"] as BalonPark.Models.Settings;
    var companyName = settings?.CompanyName ?? "Balon Park Şişme Oyun Grupları";
    ViewData["Title"] = $"{Model.Product?.Name} - {Model.Product?.CategoryName} | {companyName}";
    ViewData["Description"] = !string.IsNullOrEmpty(Model.Product?.Description) 
        ? $"{Model.Product.Name} - {Model.Product.Description.Substring(0, Math.Min(Model.Product.Description.Length, 150))}... | {Model.Product.CategoryName} - {Model.Product.SubCategoryName} | {companyName}"
        : $"{Model.Product?.Name} - {Model.Product?.CategoryName} - {Model.Product?.SubCategoryName} şişme oyun grubu. {companyName}'ta kaliteli şişme oyun parkı, şişme kaydırak, şişme havuz, şişme rodeo, top havuzu, iç mekan oyun parkları, trambolin, softplay oyuncaklar.";
    ViewData["Keywords"] = $"{Model.Product?.Name}, {Model.Product?.CategoryName}, {Model.Product?.SubCategoryName}, şişme oyun parkı, şişme kaydırak, şişme havuz, şişme rodeo, top havuzu, iç mekan oyun parkları, trambolin, softplay oyuncaklar, yer balonları, balon tak, fly tüp, şişme kostüm, reklam balonları, balon park, çocuk oyun grupları, şişme oyuncaklar, çocuk parkı, oyun alanı";
    ViewData["Image"] = Model.MainImage != null ? ((IUrlService?)ViewData["UrlService"])?.GetImageUrl(Model.MainImage.LargePath) ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/{Model.MainImage.LargePath}" : ((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/no-image.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/no-image.png";
    ViewData["ProductPrice"] = Model.Product?.Price.ToString("F2", System.Globalization.CultureInfo.InvariantCulture);
    ViewData["ProductCurrency"] = "TRY";
    ViewData["ProductAvailability"] = Model.Product?.Stock > 0 ? "in stock" : "out of stock";
    ViewData["ProductCondition"] = "new";
    ViewData["ProductBrand"] = companyName;
    ViewData["ProductSku"] = $"U-{Model.Product?.Id}";

    var productCategorySlug = Model.Product?.CategorySlug ?? string.Empty;
    var productSubCategorySlug = Model.Product?.SubCategorySlug ?? string.Empty;
    var productSlug = Model.Product?.Slug ?? string.Empty;
    var productShareUrl = ((IUrlService?)ViewData["UrlService"])?.GetProductUrl(productCategorySlug, productSubCategorySlug, productSlug)
        ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/category/{productCategorySlug}/{productSubCategorySlug}/{productSlug}";
    var productShareTitle = Uri.EscapeDataString(Model.Product?.Name ?? string.Empty);
    var whatsAppDigits = string.IsNullOrEmpty(settings?.WhatsApp) ? "" : new string(settings.WhatsApp.Where(c => char.IsDigit(c)).ToArray());
}


<!-- Product Section Start -->
<div class="space-y-6">
    @await Html.PartialAsync("Shared/_Breadcrumb", new List<BreadcrumbItem>
    {
        BreadcrumbItem.Link("Ana Sayfa", "/"),
        BreadcrumbItem.Link(Model.Product?.CategoryName ?? "Kategoriler", $"/category/{Model.Product?.CategorySlug}"),
        BreadcrumbItem.Link(Model.Product?.SubCategoryName ?? "Alt Kategoriler", $"/category/{Model.Product?.CategorySlug}/{Model.Product?.SubCategorySlug}"),
        BreadcrumbItem.Current(Model.Product?.Name ?? "")
    })

    <!-- Product meta bar: görüntülenme, paylaş ve aksiyonlar tek satırda, hizalı -->
    <div class="flex flex-wrap items-center justify-between gap-3 text-sm text-gray-500">
        @if ((Model.Product?.ViewCount ?? 0) > 0)
        {
            <span class="flex items-center gap-1.5" aria-label="@Model.Product!.ViewCount görüntülenme">
                <i data-lucide="eye" class="w-4 h-4 text-gray-400" aria-hidden="true"></i>
                <span>@Model.Product!.ViewCount görüntülenme</span>
            </span>
        }
        <div class="flex items-center gap-3 ml-auto">
            <span class="sr-only">Paylaş</span>
            <div class="flex items-center gap-1" role="group" aria-label="Sosyal medyada paylaş">
                <a href="https://www.facebook.com/sharer/sharer.php?u=@productShareUrl" target="_blank" rel="noopener noreferrer" class="w-8 h-8 rounded-full flex items-center justify-center text-gray-400 hover:text-[#1877f2] hover:bg-gray-100 transition" title="Facebook'ta paylaş" aria-label="Facebook'ta paylaş"><i data-lucide="facebook" class="w-4 h-4"></i></a>
                <a href="https://twitter.com/intent/tweet?url=@productShareUrl&text=@productShareTitle" target="_blank" rel="noopener noreferrer" class="w-8 h-8 rounded-full flex items-center justify-center text-gray-400 hover:text-[#1da1f2] hover:bg-gray-100 transition" title="Twitter'da paylaş" aria-label="Twitter'da paylaş"><i data-lucide="twitter" class="w-4 h-4"></i></a>
                <a href="https://www.linkedin.com/sharing/share-offsite/?url=@productShareUrl" target="_blank" rel="noopener noreferrer" class="w-8 h-8 rounded-full flex items-center justify-center text-gray-400 hover:text-[#0077b5] hover:bg-gray-100 transition" title="LinkedIn'de paylaş" aria-label="LinkedIn'de paylaş"><i data-lucide="linkedin" class="w-4 h-4"></i></a>
                <a href="https://wa.me/?text=@productShareTitle%20@productShareUrl" target="_blank" rel="noopener noreferrer" class="w-8 h-8 rounded-full flex items-center justify-center text-gray-400 hover:text-[#25d366] hover:bg-gray-100 transition" title="WhatsApp'ta paylaş" aria-label="WhatsApp'ta paylaş"><i data-lucide="message-circle" class="w-4 h-4"></i></a>
            </div>
            <div class="flex items-center gap-0.5 border-l border-gray-200 pl-3" role="group" aria-label="Ürün aksiyonları">
                <button type="button" class="favorite-btn-detail w-9 h-9 rounded flex items-center justify-center text-gray-400 hover:text-primary hover:bg-gray-100 transition" data-product-id="@Model.Product?.Id" title="Favorilere Ekle" aria-label="Favorilere Ekle"><i data-lucide="heart" class="w-4 h-4"></i></button>
                <button type="button" class="compare-btn-detail w-9 h-9 rounded flex items-center justify-center text-gray-400 hover:text-primary hover:bg-gray-100 transition" data-product-id="@Model.Product?.Id" data-product-url="/category/@Model.Product?.CategorySlug/@Model.Product?.SubCategorySlug/@Model.Product?.Slug" data-product-slug="@Model.Product?.Slug" title="Karşılaştır" aria-label="Karşılaştır"><i data-lucide="shuffle" class="w-4 h-4"></i></button>
            </div>
        </div>
    </div>

    <!-- Main Product Content: sol galeri (sabit genişlik), sağ ürün bilgisi (kalan alan) -->
    <div class="grid grid-cols-1 lg:grid-cols-[minmax(0,460px)_1fr] gap-6 lg:gap-8 items-start">
        <div class="product-gallery product-detail-gallery w-full max-w-full">
            <div class="product-gallery-main-wrap">
            <div class="swiper productMainSwiper product-gallery-main" data-swiper-autoplay="false" id="lightgallery">
                <div class="swiper-wrapper">
                    @if (Model.ProductImages.Any())
                    {
                        @foreach (var image in Model.ProductImages)
                        {
                            <div class="swiper-slide">
                                <div class="image-wrapper product-image-wrap product-gallery-slide-inner">
                                    <span class="img-loading-spinner" aria-hidden="true"></span>
                                    <a href="@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl(image.LargePath) ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/{image.LargePath}")"
                                       data-lg-size="1600-1600"
                                       data-src="@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl(image.LargePath) ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/{image.LargePath}")"
                                       data-sub-html="<h4>@Html.Raw(Model.Product?.Name)</h4>"
                                       class="product-gallery-link">
                                        <img src="@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl(image.LargePath) ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/{image.LargePath}")"
                                             class="lazy-image main-image product-gallery-img"
                                             alt="@Html.Raw(Model.Product?.Name)"
                                             loading="lazy"
                                             onload="this.classList.add('loaded'); var s=this.closest('.product-image-wrap').querySelector('.img-loading-spinner'); if(s) s.classList.add('hidden');"
                                             onerror="this.src='@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/no-image.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/no-image.png")'; this.classList.add('loaded'); var s=this.closest('.product-image-wrap').querySelector('.img-loading-spinner'); if(s) s.classList.add('hidden');">
                                    </a>
                                </div>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="swiper-slide">
                            <div class="image-wrapper product-image-wrap product-gallery-slide-inner">
                                <span class="img-loading-spinner" aria-hidden="true"></span>
                                <a href="@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/no-image.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/no-image.png")"
                                   data-lg-size="800-800"
                                   data-src="@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/no-image.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/no-image.png")"
                                   data-sub-html="<h4>@Html.Raw(Model.Product?.Name)</h4>"
                                   class="product-gallery-link">
                                    <img src="@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/no-image.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/no-image.png")"
                                         class="lazy-image main-image product-gallery-img"
                                         alt="@Html.Raw(Model.Product?.Name)"
                                         loading="lazy"
                                         onload="this.classList.add('loaded'); var s=this.closest('.product-image-wrap').querySelector('.img-loading-spinner'); if(s) s.classList.add('hidden');">
                                </a>
                            </div>
                        </div>
                    }
                </div>
                <div class="swiper-button-next product-gallery-next" aria-label="Sonraki resim"></div>
                <div class="swiper-button-prev product-gallery-prev" aria-label="Önceki resim"></div>
                <div class="swiper-pagination product-gallery-pagination" aria-label="Resim sayfası"></div>
            </div>
            </div>

            @if (Model.ProductImages.Count > 1)
            {
                <div class="swiper productThumbsSwiper product-gallery-thumbs">
                    <div class="swiper-wrapper">
                        @foreach (var image in Model.ProductImages)
                        {
                            <div class="swiper-slide">
                                <div class="thumbnail-item product-image-wrap" role="button" tabindex="0" aria-label="Resmi görüntüle">
                                    <span class="img-loading-spinner" aria-hidden="true"></span>
                                    <img src="@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl(image.ThumbnailPath) ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/{image.ThumbnailPath}")"
                                         class="lazy-image product-gallery-thumb-img"
                                         alt="@Html.Raw(Model.Product?.Name)"
                                         loading="lazy"
                                         onload="this.classList.add('loaded'); var s=this.closest('.product-image-wrap').querySelector('.img-loading-spinner'); if(s) s.classList.add('hidden');"
                                         onerror="this.src='@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/no-image.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/no-image.png")'; this.classList.add('loaded'); var s=this.closest('.product-image-wrap').querySelector('.img-loading-spinner'); if(s) s.classList.add('hidden');">
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>

        <!-- Product Information -->
        <div class="space-y-4 min-w-0">
            @{
                var selectedCurrency = ViewData["SelectedCurrency"]?.ToString() ?? "TL";
            }
            <!-- Ürün adı (fiyatın üstünde) -->
            <h1 class="text-ink text-xl font-medium">@Html.Raw(Model.Product?.Name)</h1>
            <!-- Ürün etiketleri (badge'ler) -->
            @{
                var hasBadges = Model.Product?.IsDiscounted == true || Model.Product?.IsPopular == true || Model.Product?.IsProjectSpecial == true;
            }
            @if (hasBadges)
            {
                <div class="flex flex-wrap gap-2 mt-2">
                    @if (Model.Product?.IsDiscounted == true)
                    {
                        <span class="inline-flex items-center px-2.5 py-1 rounded text-xs font-medium bg-sky-100 text-sky-800">İndirimli Ürün</span>
                    }
                    @if (Model.Product?.IsPopular == true)
                    {
                        <span class="inline-flex items-center px-2.5 py-1 rounded text-xs font-medium bg-amber-100 text-amber-800">Popüler</span>
                    }
                    @if (Model.Product?.IsProjectSpecial == true)
                    {
                        <span class="inline-flex items-center px-2.5 py-1 rounded text-xs font-medium bg-violet-100 text-violet-800">Projeye özel</span>
                    }
                </div>
            }
            <!-- Price -->
            <div class="flex flex-wrap items-center justify-between gap-4 border-b border-gray-100 pb-4">
                <div>
                    @if (Model.Product?.Price <= 0)
                    {
                        <p class="text-sm text-gray-500">Fiyat için iletişime geçin</p>
                    }
                    else
                    {
                        <div class="price-main price-tl text-primary text-2xl font-semibold @(selectedCurrency == "TL" ? "block" : "hidden")">₺@Model.Product?.Price.ToString("N2")</div>
                        <div class="price-main price-usd text-primary text-2xl font-semibold @(selectedCurrency == "USD" ? "block" : "hidden")">$@Model.Product?.UsdPrice.ToString("N2")</div>
                        <div class="price-main price-eur text-primary text-2xl font-semibold @(selectedCurrency == "EUR" ? "block" : "hidden")">€@Model.Product?.EuroPrice.ToString("N2")</div>
                    }
                </div>
            </div>

            <!-- Ürün kodu (tek yerde) & WhatsApp -->
            <div class="flex flex-wrap items-center justify-between gap-3 py-3 border-b border-gray-100">
                <span class="flex items-center gap-2 text-sm text-gray-600" aria-label="Ürün kodu">
                    <i data-lucide="hash" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                    <span class="font-medium text-ink">U-@Model.Product?.Id</span>
                </span>
                @if (!string.IsNullOrEmpty(whatsAppDigits))
                {
                    <a href="https://wa.me/@whatsAppDigits?text=@(Uri.EscapeDataString($"Bu ürün hakkında bilgi almak istiyorum: {Model.Product?.Name}"))%20@(((IUrlService?)ViewData["UrlService"])?.GetProductUrl(Model.Product?.CategorySlug ?? "", Model.Product?.SubCategorySlug ?? "", Model.Product?.Slug ?? "") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/category/{Model.Product?.CategorySlug}/{Model.Product?.SubCategorySlug}/{Model.Product?.Slug}")" target="_blank" rel="noopener noreferrer" title="WhatsApp ile bilgi al" class="inline-flex items-center gap-2 py-2 px-3 rounded bg-[#25d366] text-white text-sm font-medium hover:opacity-90 transition">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
                        <span>WhatsApp</span>
                    </a>
                }
            </div>

            <!-- Stock -->
            <div class="py-3 border-b border-gray-100">
                @if (Model.Product?.Stock > 0)
                {
                    <div class="flex items-center gap-2 text-sm text-support">
                        <i data-lucide="check-circle" class="w-5 h-5"></i>
                        <span>Stokta Mevcut</span>
                        <span class="text-gray-500">(@Model.Product.Stock adet)</span>
                    </div>
                }
                else
                {
                    <div class="flex items-center gap-2 text-sm text-accent">
                        <i data-lucide="x-circle" class="w-5 h-5"></i>
                        <span>Stokta Yok</span>
                    </div>
                }
            </div>

            <!-- Teslimat (otomatik metin: Min–Max iş günü) -->
            @{
                var deliveryMin = Model.Product?.DeliveryDaysMin;
                var deliveryMax = Model.Product?.DeliveryDaysMax;
                var deliveryText = (deliveryMin != null && deliveryMax != null)
                    ? (deliveryMin == deliveryMax ? $"{deliveryMin} iş günü" : $"{deliveryMin}-{deliveryMax} iş günü")
                    : (deliveryMin != null ? $"{deliveryMin} iş günü" : (deliveryMax != null ? $"{deliveryMax} iş günü" : null));
                if (string.IsNullOrEmpty(deliveryText) && !string.IsNullOrEmpty(Model.Product?.DeliveryDays)) { deliveryText = Model.Product.DeliveryDays; }
            }
            @if (!string.IsNullOrEmpty(deliveryText))
            {
                <div class="py-3 border-b border-gray-100">
                    <div class="flex items-center gap-2 text-sm text-gray-600">
                        <i data-lucide="truck" class="w-5 h-5 text-primary flex-shrink-0" aria-hidden="true"></i>
                        <span>Teslimat: @deliveryText</span>
                    </div>
                </div>
            }

            <!-- Özellik etiketleri (boyut, ağırlık, renk, ateşe dayanıklı, kumaş, üfleyici) - metinler otomatik -->
            @{
                var dimParts = new[] { Model.Product?.InflatedLength, Model.Product?.InflatedWidth, Model.Product?.InflatedHeight }.Where(s => !string.IsNullOrEmpty(s)).ToList();
                var dimensionsStr = dimParts.Count >= 3 ? $"{dimParts[0]} x {dimParts[1]} x {dimParts[2]} m" : (dimParts.Count > 0 ? string.Join(" x ", dimParts) + " m" : null);
                var hasWeight = (Model.Product?.InflatedWeightKg ?? Model.Product?.PackagedWeightKg) != null;
                var weightKg = Model.Product?.InflatedWeightKg ?? Model.Product?.PackagedWeightKg;
                var materialText = Model.Product?.MaterialWeightGrm2 != null ? $"{Model.Product.MaterialWeightGrm2} gr/m² kumaş" : (!string.IsNullOrEmpty(Model.Product?.MaterialWeight) ? Model.Product.MaterialWeight + " kumaş" : null);
                var hasFeatures = !string.IsNullOrEmpty(dimensionsStr) || hasWeight || !string.IsNullOrEmpty(Model.Product?.ColorOptions) || Model.Product?.IsFireResistant == true || !string.IsNullOrEmpty(materialText) || !string.IsNullOrEmpty(Model.Product?.FanDescription);
            }
            @if (hasFeatures)
            {
                <div class="py-3 border-b border-gray-100">
                    <div class="flex flex-wrap gap-2">
                        @if (!string.IsNullOrEmpty(dimensionsStr))
                        {
                            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-gray-200 bg-gray-50 text-sm text-ink font-medium" title="Boyutlar">
                                <i data-lucide="ruler" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                                @dimensionsStr
                            </span>
                        }
                        @if (hasWeight && weightKg != null)
                        {
                            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-gray-200 bg-gray-50 text-sm text-ink font-medium" title="Ağırlık">
                                <i data-lucide="weight" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                                @weightKg kg
                            </span>
                        }
                        @if (!string.IsNullOrEmpty(Model.Product?.ColorOptions))
                        {
                            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-gray-200 bg-gray-50 text-sm text-ink font-medium cursor-default" title="Renk seçenekleri">
                                <i data-lucide="palette" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                                @Model.Product.ColorOptions
                            </span>
                        }
                        @if (Model.Product?.IsFireResistant == true)
                        {
                            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-gray-200 bg-gray-50 text-sm text-ink font-medium" title="Ateşe dayanıklı">
                                <i data-lucide="flame" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                                Ateşe Dayanıklı
                            </span>
                        }
                        @if (!string.IsNullOrEmpty(materialText))
                        {
                            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-gray-200 bg-gray-50 text-sm text-ink font-medium cursor-default" title="Kumaş ağırlığı">
                                <i data-lucide="layers" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                                @materialText
                            </span>
                        }
                        @if (!string.IsNullOrEmpty(Model.Product?.FanDescription))
                        {
                            <span class="inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg border border-gray-200 bg-gray-50 text-sm text-ink font-medium" title="Üfleyici">
                                <i data-lucide="wind" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                                Üfleyici dahil
                            </span>
                        }
                    </div>
                </div>
            }

            <!-- CTA -->
            <div class="flex flex-wrap gap-2">
                @if (Model.Product?.Stock > 0 && Model.Product?.Price > 0)
                {
                    @if (!string.IsNullOrEmpty(whatsAppDigits))
                    {
                        <a href="https://wa.me/@whatsAppDigits?text=@(Uri.EscapeDataString($"Bu ürünü satın almak istiyorum: {Model.Product?.Name} (Ürün Kodu: U-{Model.Product?.Id})"))%20@(((IUrlService?)ViewData["UrlService"])?.GetProductUrl(Model.Product?.CategorySlug ?? "", Model.Product?.SubCategorySlug ?? "", Model.Product?.Slug ?? "") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/category/{Model.Product?.CategorySlug}/{Model.Product?.SubCategorySlug}/{Model.Product?.Slug}")" target="_blank" rel="noopener noreferrer" title="WhatsApp ile satın al" class="inline-flex items-center gap-2 justify-center min-w-[220px] max-w-full py-3 px-4 rounded bg-primary text-white font-medium text-sm hover:bg-primary-dark transition" id="buy-now-button" aria-label="Satın Al">
                            <i data-lucide="shopping-cart" class="w-5 h-5"></i>
                            <span>Satın Al</span>
                        </a>
                    }
                }
                else if (Model.Product?.Price <= 0)
                {
                    @if (!string.IsNullOrEmpty(whatsAppDigits))
                    {
                        <a href="https://wa.me/@whatsAppDigits?text=@(Uri.EscapeDataString($"Bu ürün hakkında fiyat bilgisi almak istiyorum: {Model.Product?.Name}"))%20@(((IUrlService?)ViewData["UrlService"])?.GetProductUrl(Model.Product?.CategorySlug ?? "", Model.Product?.SubCategorySlug ?? "", Model.Product?.Slug ?? "") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/category/{Model.Product?.CategorySlug}/{Model.Product?.SubCategorySlug}/{Model.Product?.Slug}")" target="_blank" rel="noopener noreferrer" title="WhatsApp ile fiyat sor" class="inline-flex items-center gap-2 justify-center min-w-[220px] max-w-full py-3 px-4 rounded border border-gray-200 text-ink font-medium text-sm hover:bg-gray-50 transition" id="buy-now-button" aria-label="Fiyat Sor">
                            <i data-lucide="info" class="w-5 h-5"></i>
                            <span>Fiyat İçin İletişime Geçin</span>
                        </a>
                    }
                }
                else
                {
                    <button type="button" class="inline-flex items-center gap-2 justify-center min-w-[220px] max-w-full py-3 px-4 rounded border border-gray-200 text-gray-400 font-medium text-sm cursor-not-allowed" id="buy-now-button" disabled aria-label="Stokta Yok">
                        <i data-lucide="x-circle" class="w-5 h-5"></i>
                        <span>Stokta Yok</span>
                    </button>
                }
            </div>

            <!-- Özet (ürün kartında da kullanılan kısa özet) -->
            @if (!string.IsNullOrEmpty(Model.Product?.Summary))
            {
                <div class="pt-3 mt-3 border-t border-gray-100">
                    <h3 class="flex items-center gap-2 text-ink text-sm font-semibold mb-2">
                        <i data-lucide="file-text" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                        Özet
                    </h3>
                    <p class="text-sm text-ink leading-relaxed font-medium">@Html.Raw(Model.Product.Summary)</p>
                </div>
            }
        </div>
    </div>

    @{
        var hasInflated = !string.IsNullOrEmpty(Model.Product?.InflatedLength) || !string.IsNullOrEmpty(Model.Product?.InflatedWidth) || !string.IsNullOrEmpty(Model.Product?.InflatedHeight) || Model.Product?.UserCount != null;
        var hasAssembly = Model.Product?.AssemblyTime != null || Model.Product?.RequiredPersonCount != null || !string.IsNullOrEmpty(Model.Product?.FanDescription) || Model.Product?.FanWeightKg != null;
        var hasPackaged = !string.IsNullOrEmpty(Model.Product?.PackagedLength) || !string.IsNullOrEmpty(Model.Product?.PackagedDepth) || Model.Product?.PackagedWeightKg != null || Model.Product?.PackagePalletCount != null;
        var hasGeneral = Model.Product?.HasCertificate == true || !string.IsNullOrEmpty(Model.Product?.WarrantyDescription) || !string.IsNullOrEmpty(Model.Product?.AfterSalesService);
        var hasTechnicalInfo = hasInflated || hasAssembly || hasPackaged || hasGeneral;
        var hasDescription = !string.IsNullOrEmpty(Model.Product?.Description);
    }

    <!-- Açıklama (Ürün Teknik Bilgileri'nin üstünde) -->
    @if (hasDescription)
    {
        <div class="pt-4 mt-4 border-t border-gray-100">
            <h3 class="flex items-center gap-2 text-ink text-base font-semibold pb-2 border-b border-gray-100 mb-3">
                <i data-lucide="book-open" class="w-5 h-5 text-primary flex-shrink-0" aria-hidden="true"></i>
                Açıklama
            </h3>
            <div class="text-sm text-ink leading-relaxed font-medium">@Html.Raw(Model.Product?.Description)</div>
        </div>
    }

    <!-- Ürün Teknik Bilgileri -->
    @if (hasTechnicalInfo)
    {
        <div class="pt-4 mt-4 border-t border-gray-100">
            <h3 class="flex items-center gap-2 text-ink text-base font-semibold pb-2 border-b border-gray-100 mb-4">
                <i data-lucide="clipboard-list" class="w-5 h-5 text-primary flex-shrink-0" aria-hidden="true"></i>
                Ürün Teknik Bilgileri
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                @if (hasInflated)
                {
                    <div class="rounded-lg border border-gray-200 bg-gray-50/50 p-4">
                        <h4 class="flex items-center gap-2 text-sm font-semibold text-ink mb-3">
                            <i data-lucide="maximize-2" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                            Şişmiş ürün
                        </h4>
                        <dl class="space-y-2.5 text-sm">
                            @if (!string.IsNullOrEmpty(Model.Product?.InflatedLength)) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="move-horizontal" class="w-4 h-4 text-primary flex-shrink-0"></i>Uzunluk</dt><dd class="text-ink font-semibold">@Model.Product.InflatedLength m</dd></div> }
                            @if (!string.IsNullOrEmpty(Model.Product?.InflatedWidth)) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="move" class="w-4 h-4 text-primary flex-shrink-0"></i>Genişlik</dt><dd class="text-ink font-semibold">@Model.Product.InflatedWidth m</dd></div> }
                            @if (!string.IsNullOrEmpty(Model.Product?.InflatedHeight)) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="move-vertical" class="w-4 h-4 text-primary flex-shrink-0"></i>Yükseklik</dt><dd class="text-ink font-semibold">@Model.Product.InflatedHeight m</dd></div> }
                            @if (Model.Product?.UserCount != null) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="users" class="w-4 h-4 text-primary flex-shrink-0"></i>Kullanıcı Sayısı</dt><dd class="text-ink font-semibold">@Model.Product.UserCount</dd></div> }
                        </dl>
                    </div>
                }
                @if (hasAssembly)
                {
                    <div class="rounded-lg border border-gray-200 bg-gray-50/50 p-4">
                        <h4 class="flex items-center gap-2 text-sm font-semibold text-ink mb-3">
                            <i data-lucide="wrench" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                            Montaj / demontaj
                        </h4>
                        <dl class="space-y-2.5 text-sm">
                            @if (Model.Product?.AssemblyTime != null) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="clock" class="w-4 h-4 text-primary flex-shrink-0"></i>Montaj ve demontaj süresi</dt><dd class="text-ink font-semibold">@(Model.Product.AssemblyTime) saat</dd></div> }
                            @if (Model.Product?.RequiredPersonCount != null) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="users" class="w-4 h-4 text-primary flex-shrink-0"></i>Gerekli kişi sayısı</dt><dd class="text-ink font-semibold">@(Model.Product.RequiredPersonCount) kişi</dd></div> }
                            @if (!string.IsNullOrEmpty(Model.Product?.FanDescription)) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="wind" class="w-4 h-4 text-primary flex-shrink-0"></i>Fan</dt><dd class="text-ink font-semibold">@Model.Product.FanDescription</dd></div> }
                            @if (Model.Product?.FanWeightKg != null) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="weight" class="w-4 h-4 text-primary flex-shrink-0"></i>Fan ağırlığı</dt><dd class="text-ink font-semibold">@(Model.Product.FanWeightKg) kg</dd></div> }
                        </dl>
                    </div>
                }
                @if (hasPackaged)
                {
                    <div class="rounded-lg border border-gray-200 bg-gray-50/50 p-4">
                        <h4 class="flex items-center gap-2 text-sm font-semibold text-ink mb-3">
                            <i data-lucide="package" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                            Paketlenmiş ürünün özellikleri
                        </h4>
                        <dl class="space-y-2.5 text-sm">
                            @if (!string.IsNullOrEmpty(Model.Product?.PackagedLength)) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="ruler" class="w-4 h-4 text-primary flex-shrink-0"></i>Uzunluk</dt><dd class="text-ink font-semibold">@Model.Product.PackagedLength cm</dd></div> }
                            @if (!string.IsNullOrEmpty(Model.Product?.PackagedDepth)) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="box" class="w-4 h-4 text-primary flex-shrink-0"></i>Derinlik</dt><dd class="text-ink font-semibold">@Model.Product.PackagedDepth cm</dd></div> }
                            @if (Model.Product?.PackagedWeightKg != null) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="weight" class="w-4 h-4 text-primary flex-shrink-0"></i>Ağırlık</dt><dd class="text-ink font-semibold">@(Model.Product.PackagedWeightKg) kg</dd></div> }
                            @if (Model.Product?.PackagePalletCount != null) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="layers" class="w-4 h-4 text-primary flex-shrink-0"></i>Paket / palet sayısı</dt><dd class="text-ink font-semibold">@Model.Product.PackagePalletCount</dd></div> }
                        </dl>
                    </div>
                }
                @if (hasGeneral)
                {
                    <div class="rounded-lg border border-gray-200 bg-gray-50/50 p-4">
                        <h4 class="flex items-center gap-2 text-sm font-semibold text-ink mb-3">
                            <i data-lucide="shield-check" class="w-4 h-4 text-primary flex-shrink-0" aria-hidden="true"></i>
                            Genel
                        </h4>
                        <dl class="space-y-2.5 text-sm">
                            @if (Model.Product?.HasCertificate == true) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="award" class="w-4 h-4 text-primary flex-shrink-0"></i>Sertifika</dt><dd class="text-ink font-semibold">Sertifika var</dd></div> }
                            @if (!string.IsNullOrEmpty(Model.Product?.WarrantyDescription)) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="shield-check" class="w-4 h-4 text-primary flex-shrink-0"></i>Garanti</dt><dd class="text-ink font-semibold">@Model.Product.WarrantyDescription</dd></div> }
                            @if (!string.IsNullOrEmpty(Model.Product?.AfterSalesService)) { <div class="flex justify-between gap-2 items-center"><dt class="flex items-center gap-2 text-gray-600 font-medium"><i data-lucide="headset" class="w-4 h-4 text-primary flex-shrink-0"></i>Garanti Sonrası Hizmet</dt><dd class="text-ink font-semibold">@Model.Product.AfterSalesService</dd></div> }
                        </dl>
                    </div>
                }
            </div>
        </div>
    }

    <!-- Teknik Özellikler -->
    @if (!string.IsNullOrEmpty(Model.Product?.TechnicalDescription))
    {
        <div class="pt-4 border-t border-gray-100">
            <h3 class="flex items-center gap-2 text-ink text-base font-semibold pb-2 border-b border-gray-100 mb-3">
                <i data-lucide="list-checks" class="w-5 h-5 text-primary flex-shrink-0" aria-hidden="true"></i>
                Teknik Özellikler
            </h3>
            <div class="technical-description-html text-ink max-w-none">@Html.Raw(Model.Product.TechnicalDescription)</div>
        </div>
    }
</div>

<!-- Product Section End -->

@section Scripts {
<script>
    // Swiper instances
    let productMainSwiper;
    let productThumbsSwiper;

    // Initialize Swipers when DOM is loaded (Swiper 11: no loopedSlides)
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof window.Swiper === 'undefined') {
            console.warn('Swiper not loaded; product gallery will not be interactive.');
            return;
        }
        const mainSwiperElement = document.querySelector('.productMainSwiper');
        const thumbsSwiperElement = document.querySelector('.productThumbsSwiper');
        if (!mainSwiperElement) return;

        // Thumbnail swiper: büyük thumblar, küçük aralık (spaceBetween: 6)
        if (thumbsSwiperElement) {
            productThumbsSwiper = new window.Swiper('.productThumbsSwiper', {
                spaceBetween: 6,
                slidesPerView: 'auto',
                freeMode: true,
                watchSlidesProgress: true,
                breakpoints: {
                    320: { slidesPerView: 3, spaceBetween: 6 },
                    640: { slidesPerView: 4, spaceBetween: 6 },
                    768: { slidesPerView: 5, spaceBetween: 6 },
                    1024: { slidesPerView: 6, spaceBetween: 6 },
                },
            });
        }

        const slideCount = mainSwiperElement.querySelectorAll('.swiper-slide').length;
        const swiperConfig = {
            spaceBetween: 0,
            speed: 300,
            autoHeight: false, /* kare alan sabit kalsın */
            navigation: {
                nextEl: mainSwiperElement.querySelector('.product-gallery-next'),
                prevEl: mainSwiperElement.querySelector('.product-gallery-prev'),
            },
            pagination: {
                el: mainSwiperElement.querySelector('.product-gallery-pagination'),
                type: 'fraction',
                formatFractionCurrent: function (n) { return n; },
                formatFractionTotal: function (n) { return n; },
            },
            loop: slideCount > 1,
        };
        if (productThumbsSwiper) {
            swiperConfig.thumbs = { swiper: productThumbsSwiper };
        }

        productMainSwiper = new window.Swiper('.productMainSwiper', swiperConfig);
    });

    // Error handling for Swiper
    window.addEventListener('error', function(e) {
        if (e.message && e.message.includes('Swiper')) {
            // Fallback: show first image only
            const slides = document.querySelectorAll('.swiper-slide');
            slides.forEach((slide, index) => {
                if (index === 0) {
                    slide.style.display = 'block';
                } else {
                    slide.style.display = 'none';
                }
            });
        }
    });
</script>

<!-- lightGallery JS -->
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.2/lightgallery.min.js"></script>

<!-- lightGallery Plugins -->
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.2/plugins/thumbnail/lg-thumbnail.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.2/plugins/zoom/lg-zoom.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.2/plugins/autoplay/lg-autoplay.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.2/plugins/fullscreen/lg-fullscreen.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.2/plugins/rotate/lg-rotate.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.2/plugins/share/lg-share.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.2/plugins/hash/lg-hash.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.7.2/plugins/pager/lg-pager.min.js"></script>

<!-- lightGallery Initialization -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const lightGalleryElement = document.getElementById('lightgallery');
        
        if (lightGalleryElement) {
            lightGallery(lightGalleryElement, {
                // Core settings
                speed: 500,
                licenseKey: '0000-0000-000-0000', // Demo license
                
                // Plugins
                plugins: [
                    lgThumbnail,
                    lgZoom,
                    lgAutoplay,
                    lgFullscreen,
                    lgRotate,
                    lgShare,
                    lgHash,
                    lgPager
                ],
                
                // Thumbnail settings
                thumbnail: true,
                animateThumb: true,
                showThumbByDefault: true,
                thumbWidth: 100,
                thumbHeight: '80px',
                thumbMargin: 5,
                
                // Zoom settings
                zoom: true,
                scale: 1,
                actualSize: true,
                actualSizeIcons: {
                    zoomIn: 'lg-zoom-in',
                    zoomOut: 'lg-zoom-out',
                },
                
                // Autoplay settings
                autoplay: false,
                autoplayControls: true,
                progressBar: true,
                pause: 3000,
                
                // Fullscreen
                fullScreen: true,
                
                // Rotate & Flip
                rotate: true,
                flipHorizontal: true,
                flipVertical: true,
                rotateLeft: true,
                rotateRight: true,
                
                // Share settings
                share: true,
                facebook: true,
                twitter: true,
                pinterest: true,
                
                // Hash (URL)
                hash: true,
                galleryId: 'product-gallery',
                
                // Pager
                pager: true,
                
                // Additional settings
                download: true,
                counter: true,
                loop: true,
                escKey: true,
                keyPress: true,
                controls: true,
                slideEndAnimation: true,
                hideControlOnEnd: false,
                mousewheel: true,
                
                // Mobile
                mobileSettings: {
                    controls: true,
                    showCloseIcon: true,
                    download: true,
                    rotate: true
                },
                
                // Animation
                mode: 'lg-fade',
                
                // Selector (work with swiper)
                selector: 'a',
                
                // Accessibility
                ariaLabelledby: 'Product Gallery',
                ariaDescribedby: '@Html.Raw(Model.Product?.Name ?? "")',
            });
            
            console.log('lightGallery initialized with all features');
        }
    });
</script>
}

@section Styles {
<!-- lightGallery CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.7.2/css/lightgallery-bundle.min.css">
<style>
    /* ========== Product detail gallery: kompakt boyut ========== */
    .product-detail-gallery {
        display: flex;
        flex-direction: column;
        gap: 12px;
        padding: 0;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        overflow: hidden;
        background: #fafafa;
        box-shadow: 0 1px 3px rgba(0,0,0,0.06);
        max-width: 460px;
        margin-left: auto;
        margin-right: auto;
    }
    @@media (min-width: 1024px) {
        .product-detail-gallery {
            margin-left: 0;
            margin-right: 0;
            max-width: 100%;
        }
    }

    /* Ana galeri: yükseklik genişliğin %85’i */
    .product-detail-gallery .product-gallery-main-wrap {
        position: relative;
        width: 100%;
        height: 0;
        padding-bottom: 85%;
        border-radius: 12px 12px 0 0;
        overflow: hidden;
        background: #fff;
        aspect-ratio: 1 / 0.85;
    }
    .product-detail-gallery .product-gallery-main {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        width: 100% !important;
        height: 100% !important;
        max-height: 100% !important;
        border-radius: 12px 12px 0 0;
        overflow: hidden;
    }
    .product-detail-gallery .product-gallery-main .swiper-wrapper,
    .product-detail-gallery .product-gallery-main .swiper-slide {
        height: 100% !important;
        min-height: 0;
    }
    .product-detail-gallery .product-gallery-slide-inner {
        height: 100% !important;
        min-height: 0;
        overflow: hidden;
    }
    /* layout.css .product-image-wrap min-height'ı galeri içinde devre dışı */
    .product-detail-gallery .product-image-wrap {
        min-height: 0 !important;
        height: 100% !important;
    }
    .product-detail-gallery .product-gallery-link {
        display: block;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: #fff;
    }
    .product-detail-gallery .product-gallery-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
        vertical-align: middle;
    }

    /* Nav butonları: yuvarlak, gölgeli */
    .product-detail-gallery .product-gallery-next,
    .product-detail-gallery .product-gallery-prev {
        width: 40px;
        height: 40px;
        margin-top: 0;
        transform: translateY(-50%);
        background: rgba(255,255,255,0.95);
        color: #374151;
        border-radius: 50%;
        box-shadow: 0 2px 8px rgba(0,0,0,0.12);
        transition: background 0.2s, color 0.2s, box-shadow 0.2s;
    }
    .product-detail-gallery .product-gallery-next::after,
    .product-detail-gallery .product-gallery-prev::after {
        font-size: 1rem;
        font-weight: 700;
    }
    .product-detail-gallery .product-gallery-next:hover,
    .product-detail-gallery .product-gallery-prev:hover {
        background: #fff;
        color: #00A8E8;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .product-detail-gallery .product-gallery-next.swiper-button-disabled,
    .product-detail-gallery .product-gallery-prev.swiper-button-disabled {
        opacity: 0.35;
    }

    /* Pagination: köşede, okunaklı */
    .product-detail-gallery .product-gallery-pagination {
        bottom: 12px !important;
        left: auto !important;
        right: 12px;
        width: auto;
        padding: 4px 10px;
        background: rgba(0,0,0,0.5);
        color: #fff;
        border-radius: 20px;
        font-size: 0.8125rem;
        font-weight: 500;
    }
    .product-detail-gallery .product-gallery-pagination .swiper-pagination-current { font-weight: 600; }

    /* Thumbnail strip: ana galeri ile aynı oran (1 : 0.85), düzgün kırpma */
    .product-detail-gallery .product-gallery-thumbs {
        margin-top: 0;
        padding: 0 4px 12px;
        overflow: hidden;
    }
    .product-detail-gallery .productThumbsSwiper .swiper-wrapper {
        align-items: center;
    }
    .product-detail-gallery .productThumbsSwiper .swiper-slide {
        width: auto !important;
        flex-shrink: 0;
        box-sizing: border-box;
    }
    .product-detail-gallery .productThumbsSwiper .thumbnail-item {
        width: 56px;
        height: 48px; /* 56 * 0.85 ≈ ana galeri oranı */
        border: 2px solid transparent;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        transition: border-color 0.2s ease, box-shadow 0.2s ease;
        background: #fff;
        flex-shrink: 0;
    }
    .product-detail-gallery .productThumbsSwiper .thumbnail-item:hover {
        border-color: #d1d5db;
    }
    .product-detail-gallery .product-gallery-thumb-img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        object-position: center;
        display: block;
        vertical-align: middle;
    }
    @@media (min-width: 640px) {
        .product-detail-gallery .productThumbsSwiper .thumbnail-item {
            width: 64px;
            height: 54px; /* 64 * 0.85 */
        }
    }
    @@media (min-width: 1024px) {
        .product-detail-gallery .productThumbsSwiper .thumbnail-item {
            width: 72px;
            height: 61px; /* 72 * 0.85 */
        }
    }
    .product-detail-gallery .productThumbsSwiper .swiper-slide-thumb-active .thumbnail-item {
        border-color: #00A8E8;
        box-shadow: 0 0 0 1px #00A8E8;
    }
    .product-detail-gallery .image-wrapper { overflow: hidden; }
</style>
}

<!-- Product Structured Data -->
@if (Model.Product != null)
{
    var jsonName = System.Text.Json.JsonSerializer.Serialize(Model.Product.Name);
    var jsonDescription = System.Text.Json.JsonSerializer.Serialize(Model.Product.Description ?? Model.Product.Name);
    var jsonCategoryName = System.Text.Json.JsonSerializer.Serialize(Model.Product.CategoryName ?? "Şişme Oyun Parkları");
    var jsonCompanyName = System.Text.Json.JsonSerializer.Serialize(Model.SiteSettings?.CompanyName ?? "Balon Park");
    var jsonCompanyNameFull = System.Text.Json.JsonSerializer.Serialize(Model.SiteSettings?.CompanyName ?? "Balon Park Şişme Oyun Grupları");
    <script type="application/ld+json">
    {
        "@@context": "https://schema.org",
        "@@type": "Product",
        "name": @Html.Raw(jsonName),
        "description": @Html.Raw(jsonDescription),
        "image": [
            @if (Model.ProductImages.Any())
            {
                var images = Model.ProductImages.Take(5).ToList();
                for (int i = 0; i < images.Count; i++)
                {
                    var image = images[i];
                    @: "@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl(image.LargePath) ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/{image.LargePath}")"@(i < images.Count - 1 ? "," : "")
                }
            }
            else
            {
                @: "@(((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/no-image.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/no-image.png")"
            }
        ],
        "sku": "U-@Model.Product.Id",
        "mpn": "U-@Model.Product.Id",
        "brand": {
            "@@type": "Brand",
            "name": @Html.Raw(jsonCompanyName)
        },
        "category": @Html.Raw(jsonCategoryName),
        "additionalProperty": [
            {
                "@@type": "PropertyValue",
                "name": "Stok Durumu",
                "value": "@(Model.Product.Stock > 0 ? "Stokta Mevcut" : "Stokta Yok")"
            }
        ],
        "offers": {
            "@@type": "Offer",
            "price": "@Model.Product.Price.ToString("F2", System.Globalization.CultureInfo.InvariantCulture)",
            "priceCurrency": "TRY",
            "availability": "@(Model.Product.Stock > 0 ? "https://schema.org/InStock" : "https://schema.org/OutOfStock")",
            "itemCondition": "https://schema.org/NewCondition",
            "seller": {
                "@@type": "Organization",
                "name": @Html.Raw(jsonCompanyNameFull),
                "url": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl($"{HttpContext.Request.Path}{HttpContext.Request.QueryString}") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}{HttpContext.Request.Path}{HttpContext.Request.QueryString}")"
            },
            "priceValidUntil": "@DateTime.Now.AddDays(30).ToString("yyyy-MM-dd")",
            "shippingDetails": {
                "@@type": "OfferShippingDetails",
                "shippingRate": {
                    "@@type": "MonetaryAmount",
                    "value": "0",
                    "currency": "TRY"
                },
                "shippingDestination": {
                    "@@type": "DefinedRegion",
                    "addressCountry": "TR"
                },
                "deliveryTime": {
                    "@@type": "ShippingDeliveryTime",
                    "businessDays": {
                        "@@type": "OpeningHoursSpecification",
                        "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"]
                    },
                    "cutoffTime": "14:00",
                    "handlingTime": {
                        "@@type": "QuantitativeValue",
                        "minValue": 1,
                        "maxValue": 2,
                        "unitCode": "DAY"
                    },
                    "transitTime": {
                        "@@type": "QuantitativeValue",
                        "minValue": 1,
                        "maxValue": 3,
                        "unitCode": "DAY"
                    }
                },
                "potentialAction": {
                    "@@type": "BuyAction",
                    "target": {
                        "@@type": "EntryPoint",
                        "urlTemplate": "@(((IUrlService?)ViewData["UrlService"])?.GetProductUrl(Model.Product.CategorySlug ?? "", Model.Product.SubCategorySlug ?? "", Model.Product.Slug ?? "") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/category/{Model.Product.CategorySlug}/{Model.Product.SubCategorySlug}/{Model.Product.Slug}")",
                        "actionPlatform": [
                            "http://schema.org/DesktopWebPlatform",
                            "http://schema.org/MobileWebPlatform"
                        ]
                    }
                }
            }
        },
        "aggregateRating": {
            "@@type": "AggregateRating",
            "ratingValue": "4.8",
            "reviewCount": "150",
            "bestRating": "5",
            "worstRating": "1"
        },
        "review": [
            {
                "@@type": "Review",
                "reviewRating": {
                    "@@type": "Rating",
                    "ratingValue": "5",
                    "bestRating": "5"
                },
                "author": {
                    "@@type": "Person",
                    "name": "Müşteri"
                },
                "reviewBody": "Çok kaliteli ve güvenli ürün. Malzeme kalitesi çok iyi.",
                "datePublished": "@DateTime.Now.AddDays(-30).ToString("yyyy-MM-dd")"
            }
        ],
        "url": "@(((IUrlService?)ViewData["UrlService"])?.GetProductUrl(Model.Product.CategorySlug ?? "", Model.Product.SubCategorySlug ?? "", Model.Product.Slug ?? "") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/category/{Model.Product.CategorySlug}/{Model.Product.SubCategorySlug}/{Model.Product.Slug}")",
        "isRelatedTo": {
            "@@type": "Product",
            "name": "Şişme Oyun Parkları",
            "category": "Çocuk Oyun Grupları"
        }
    }
    </script>
}

<!-- BreadcrumbList Structured Data -->
@if (Model.Product != null)
{
    var breadcrumbCategoryName = System.Text.Json.JsonSerializer.Serialize(Model.Product.CategoryName ?? "Kategoriler");
    var breadcrumbSubCategoryName = System.Text.Json.JsonSerializer.Serialize(Model.Product.SubCategoryName ?? "Alt Kategoriler");
    var breadcrumbProductName = System.Text.Json.JsonSerializer.Serialize(Model.Product.Name);
    <script type="application/ld+json">
    {
        "@@context": "https://schema.org",
        "@@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@@type": "ListItem",
                "position": 1,
                "name": "Ana Sayfa",
                "item": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl("/") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/")"
            },
            {
                "@@type": "ListItem",
                "position": 2,
                "name": @Html.Raw(breadcrumbCategoryName),
                "item": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl($"/category/{Model.Product.CategorySlug}") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/category/{Model.Product.CategorySlug}")"
            },
            {
                "@@type": "ListItem",
                "position": 3,
                "name": @Html.Raw(breadcrumbSubCategoryName),
                "item": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl($"/category/{Model.Product.CategorySlug}/{Model.Product.SubCategorySlug}") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/category/{Model.Product.CategorySlug}/{Model.Product.SubCategorySlug}")"
            },
            {
                "@@type": "ListItem",
                "position": 4,
                "name": @Html.Raw(breadcrumbProductName),
                "item": "@(((IUrlService?)ViewData["UrlService"])?.GetProductUrl(Model.Product.CategorySlug ?? "", Model.Product.SubCategorySlug ?? "", Model.Product.Slug ?? "") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/category/{Model.Product.CategorySlug}/{Model.Product.SubCategorySlug}/{Model.Product.Slug}")"
            }
        ]
    }
    </script>
}

