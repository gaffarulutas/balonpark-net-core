@page "/search"
@model SearchModel
@{
    var settings = ViewData["SiteSettings"] as BalonPark.Models.Settings;
    var companyName = settings?.CompanyName ?? "Balon Park Şişme Oyun Grupları";
    ViewData["Title"] = "Arama Sonuçları";
    ViewData["Description"] = $"'{Model.Query}' için arama sonuçları - {companyName}";
    ViewData["Keywords"] = $"arama, {Model.Query}, şişme oyun parkı, şişme kaydırak, şişme havuz, şişme rodeo, top havuzu, iç mekan oyun parkları, trambolin, softplay oyuncaklar, yer balonları, balon tak, fly tüp, şişme kostüm, reklam balonları, balon park";
    ViewData["Image"] = settings?.Logo != null ? (((IUrlService?)ViewData["UrlService"])?.GetImageUrl(settings.Logo) ?? settings.Logo) : (((IUrlService?)ViewData["UrlService"])?.GetImageUrl("/assets/images/logo/logo.png") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/assets/images/logo/logo.png");
}

<!-- Search Results Page Structured Data -->
<script type="application/ld+json">
{
    "@@context": "https://schema.org",
    "@@type": "SearchResultsPage",
    "name": "Arama Sonuçları - '@Html.Raw(Model.Query)'",
    "description": "'@Html.Raw(Model.Query)' için arama sonuçları - @Html.Raw(companyName)",
    "url": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl($"/search?q={Uri.EscapeDataString(Model.Query)}") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/search?q={Uri.EscapeDataString(Model.Query)}")",
    "mainEntity": {
        "@@type": "ItemList",
        "name": "'@Html.Raw(Model.Query)' Arama Sonuçları",
        "description": "'@Html.Raw(Model.Query)' için bulunan ürünler ve kategoriler",
        "numberOfItems": "@Model.Products.Count()",
        "itemListElement": [
            @{
                var itemsToShow = Model.Products.Take(20).ToList();
                for (var i = 0; i < itemsToShow.Count; i++)
                {
                    var productWithImage = itemsToShow[i];
                    var product = productWithImage.Product;
                    var urlService = (IUrlService?)ViewData["UrlService"];
                    var baseUrl = $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}";
                    @: {
                    @:     "@@type": "ListItem",
                    @:     "position": @(i + 1),
                    @:      "item": {
                    @:         "@@type": "Product",
                    @:         "name": "@Html.Raw(product.Name.Replace("\"", "\\\""))",
                    @:         "description": "@Html.Raw((product.Description ?? product.Name).Replace("\"", "\\\""))",
                    @:         "url": "@(urlService?.GetProductUrl(product.CategorySlug ?? "", product.SubCategorySlug ?? "", product.Slug) ?? $"{baseUrl}/category/{product.CategorySlug}/{product.SubCategorySlug}/{product.Slug}")",
                    @:         "image": "@(urlService?.GetImageUrl(productWithImage.MainImage?.LargePath ?? "/assets/images/logo/logo.png") ?? $"{baseUrl}/{(productWithImage.MainImage?.LargePath ?? "/assets/images/logo/logo.png")}")",
                    @:         "offers": {
                    @:             "@@type": "Offer",
                    @:             "price": "@product.Price.ToString("F2", System.Globalization.CultureInfo.InvariantCulture)",
                    @:             "priceCurrency": "TRY",
                    @:             "availability": "@(product.Stock > 0 ? "https://schema.org/InStock" : "https://schema.org/OutOfStock")"
                    @:         },
                    @:         "category": "@Html.Raw((product.CategoryName ?? "").Replace("\"", "\\\""))"
                    @:     }
                    @: }@(i < itemsToShow.Count - 1 ? "," : "")
                }
            }
        ]
    },
    "breadcrumb": {
        "@@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@@type": "ListItem",
                "position": 1,
                "name": "Ana Sayfa",
                "item": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl("/") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/")"
            },
            {
                "@@type": "ListItem",
                "position": 2,
                "name": "Arama Sonuçları",
                "item": "@(((IUrlService?)ViewData["UrlService"])?.GetPageUrl($"/search?q={Uri.EscapeDataString(Model.Query)}") ?? $"{HttpContext.Request.Scheme}://{HttpContext.Request.Host}/search?q={Uri.EscapeDataString(Model.Query)}")"
            }
        ]
    }
}
</script>

<div class="space-y-4 sm:space-y-6">
    <nav class="flex items-center gap-1.5 text-sm text-gray-500" aria-label="Breadcrumb">
        <a href="/" class="text-ink hover:text-primary transition">Ana Sayfa</a>
        <span>/</span>
        <span class="text-ink font-medium">Arama Sonuçları</span>
    </nav>

    <div class="pt-1 pb-2.5 border-b border-gray-100">
        <h2 class="text-ink text-base font-medium">Arama Sonuçları</h2>
        <p class="text-gray-400 text-xs mt-0.5">
            @if (!string.IsNullOrEmpty(Model.Query))
            {
                <span>&quot;<strong class="text-ink">@Model.Query</strong>&quot; için @Model.Products.Count() ürün bulundu.</span>
            }
            else
            {
                <span>Lütfen arama yapmak için bir kelime girin.</span>
            }
        </p>
    </div>

    @if (Model.Products.Any())
    {
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
            @foreach (var item in Model.Products)
            {
                @await Html.PartialAsync("Shared/_ProductCard", new ProductCardViewModel { Item = item, SelectedCurrency = Model.SelectedCurrency })
            }
        </div>
    }
    else if (!string.IsNullOrEmpty(Model.Query))
    {
        <div class="col-span-full text-center py-12 px-4 bg-gray-50 rounded border border-gray-100">
            <i data-lucide="search" class="w-12 h-12 text-gray-300 mb-3"></i>
            <h3 class="text-base font-medium text-ink">"@Model.Query" için ürün bulunamadı</h3>
            <p class="text-sm text-gray-500 mt-1">Farklı anahtar kelimelerle arama yapmayı deneyin veya kategorilerimizi inceleyin.</p>
            <a href="/" class="inline-flex items-center gap-2 mt-4 px-5 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg font-medium text-sm transition w-fit">
                <i data-lucide="home" class="w-4 h-4 inline-block align-middle"></i> Ana Sayfaya Dön
            </a>
        </div>
    }
    else
    {
        <div class="col-span-full text-center py-12 px-4 bg-gray-50 rounded border border-gray-100">
            <i data-lucide="alert-triangle" class="w-12 h-12 text-gray-300 mb-3"></i>
            <h3 class="text-base font-medium text-ink">Arama terimi gerekli</h3>
            <p class="text-sm text-gray-500 mt-1">Lütfen arama yapmak için bir kelime girin.</p>
            <a href="/" class="inline-flex items-center gap-2 mt-4 px-5 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg font-medium text-sm transition w-fit">
                <i data-lucide="home" class="w-4 h-4 inline-block align-middle"></i> Ana Sayfaya Dön
            </a>
        </div>
    }
</div>
